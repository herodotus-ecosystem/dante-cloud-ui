"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const B=require("vue-router"),N=require("pinia"),o=require("@herodotus-cloud/core"),F=require("jwt-decode"),c=require("lodash-es"),D=require("vue");require("pinia-plugin-persistedstate");var L=(t=>(t.DEFAULT="defaults",t.CLASSIC="classic",t.TRANSVERSE="transverse",t.COLUMNS="transverse",t))(L||{}),O=(t=>(t.DARK="dark",t.LIGHT="light",t.SYSTEM="system",t))(O||{}),H=(t=>(t.JIGSAW="JIGSAW",t.WORD_CLICK="WORD_CLICK",t.ARITHMETIC="ARITHMETIC",t.CHINESE="CHINESE",t.CHINESE_GIF="CHINESE_GIF",t.SPEC_GIF="SPEC_GIF",t.SPEC="SPEC",t.HUTOOL_LINE="HUTOOL_LINE",t.HUTOOL_CIRCLE="HUTOOL_CIRCLE",t.HUTOOL_SHEAR="HUTOOL_SHEAR",t.HUTOOL_GIF="HUTOOL_GIF",t))(H||{}),P=(t=>(t.INSTITUTION="INSTITUTION",t.SMS="SMS",t.WXAPP="WXAPP",t.QQ="QQ",t.WEIBO="WEIBO",t.BAIDU="BAIDU",t.WECHAT_OPEN="WECHAT_OPEN",t.WECHAT_MP="WECHAT_MP",t.WECHAT_ENTERPRISE="WECHAT_ENTERPRISE",t.WECHAT_ENTERPRISE_WEB="WECHAT_ENTERPRISE_WEB",t.DINGTALK="DINGTALK",t.DINGTALK_ACCOUNT="DINGTALK_ACCOUNT",t.ALIYUN="ALIYUN",t.TAOBAO="TAOBAO",t.ALIPAY="ALIPAY",t.TEAMBITION="TEAMBITION",t.HUAWEI_V2="HUAWEI_V2",t.FEISHU="FEISHU",t.JD="JD",t.DOUYIN="DOUYIN",t.TOUTIAO="TOUTIAO",t.MI="MI",t.RENREN="RENREN",t.MEITUAN="MEITUAN",t.ELEME="ELEME",t.KUJIALE="KUJIALE",t.XMLY="XMLY",t.GITEE="GITEE",t.OSCHINA="OSCHINA",t.CSDN="CSDN",t.GITHUB="GITHUB",t.GITLAB="GITLAB",t.STACK_OVERFLOW="STACK_OVERFLOW",t.CODING="CODING",t.GOOGLE="GOOGLE",t.MICROSOFT="MICROSOFT",t.FACEBOOK="FACEBOOK",t.LINKEDIN="LINKEDIN",t.TWITTER="TWITTER",t.AMAZON="AMAZON",t.SLACK="SLACK",t.LINE="LINE",t.OKTA="OKTA",t.PINTEREST="PINTEREST",t))(P||{}),U=(t=>(t.APP="APP",t.PERSONAL="PERSONAL",t))(U||{});const K=N.defineStore("Application",{state:()=>({leftDrawer:!0,rightDrawer:!1,signInPanel:"account"}),actions:{switchToMobilePanel(){this.signInPanel="mobile"},switchToScanPanel(){this.signInPanel="scan"},switchToAccountPanel(){this.signInPanel="account"}}});class d{static _instance=null;static _initialized=!1;options;constructor(e){this.options=e}static initialize(e){if(d._initialized)throw new Error("RouterUtilities has already been initialized");return d._instance=new d(e),d._initialized=!0,d._instance}static getInstance(){if(!d._instance)throw new Error("RouterUtilities not initialized. Call initialize() first.");return d._instance}setOptions(e){this.options=e}getOptions(){return this.options}static axiosConfig(){return this.getInstance().getOptions().config}static getRouterOptions(){return this.getInstance().getOptions().router}static getRouter(){return this.getRouterOptions().instance}static getRoutes(){return this.getInstance().getOptions().staticRoutes}static getSecurityKey(){return this.getInstance().getOptions().variables.securityKey}static getRedirectUri(){return this.getInstance().getOptions().variables.redirectUri}static isUseCrypto(){return this.getInstance().getOptions().variables.isUseCrypto}static isAutoRefreshToken(){return this.getInstance().getOptions().variables.isAutoRefreshToken}static getTenantId(){return this.getInstance().getOptions().variables.tenantId}}class m{static _instance=null;static _initialized=!1;options;router={};constructor(e){this.options=e,this.router=e.instance}static initialize(e){if(m._initialized)throw new Error("RouterUtilities has already been initialized");return m._instance=new m(e),m._initialized=!0,m._instance}static getInstance(){if(!m._instance)throw new Error("RouterUtilities not initialized. Call initialize() first.");return m._instance}setRouter(e){this.router=e}getRouter(){return this.router}isRouterExist(){return!c.isEmpty(this.router)}hasParameter(e){return!c.isEmpty(e.params)||!c.isEmpty(e.query)}isDetailRoute(e){return!!(e.meta&&e.meta.isDetailContent)}isValidDetailRoute(e){return this.isDetailRoute(e)&&this.hasParameter(e)}push(e){return this.router.push(e)}replace(e){return this.router.replace(e)}to(e,s=!1){s?this.push(e):this.replace(e)}open(e){const s=this.router.resolve(e);window.open(s.href,"_blank")}goBack(){this.router.go(-1)}refresh(){this.isRouterExist()?this.router.go(0):window.location.reload()}toRoot(){this.isRouterExist()&&this.to(this.options.path.root)}toHome(){this.isRouterExist()&&this.to(this.options.path.home)}toSignIn(){this.isRouterExist()?this.to(this.options.path.signIn):this.refresh()}getParent(e){const s=c.split(e,"/"),i=c.dropRight(s);return c.join(i,"/")}toPrev(e){if(e.path){const s=this.getParent(e.path);this.to({path:s})}else this.goBack()}}class C{static _instance=null;static _initialized=!1;extension;constructor(e){this.extension=e}static initialize(e){if(C._initialized)throw new Error("SignOutUtilities has already been initialized");return C._instance=new C(e),C._initialized=!0,C._instance}static getInstance(){if(!C._instance)throw new Error("SignOutUtilities not initialized. Call initialize() first.");return C._instance}signOut(e=!1){e||k().signOut(),this.extension(),console.log("Clear Framework Kernel Data"),k().$reset(),b().$reset(),m.getInstance().toSignIn()}signOutWithDialog(){o.Swal.fire({title:"要走了么?",text:"您确定要退出系统！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的",cancelButtonText:"取消"}).then(e=>{e.value&&this.signOut()})}tokenExpires(e,s,i,n=!1){o.Swal.fire({title:e,text:s,icon:i,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"},confirmButtonText:"已阅!",willClose:()=>{this.signOut(n)}})}}class S{static instance=null;config={};constructor(e){this.config=e}static getInstance(e){return this.instance==null&&(this.instance=new S(e)),this.instance}getOAuth2TokenAddress(){return this.config.getUaa()+"/oauth2/token"}getOAuth2RevokeAddress(){return this.config.getUaa()+"/oauth2/revoke"}getOAuth2SignOutAddress(){return this.config.getUaa()+"/oauth2/sign-out"}getOAuth2DeviceAuthorizationAddress(){return this.config.getUaa()+"/oauth2/device_authorization"}getOIDCConnectRegisterAddress(){return this.config.getUaa()+"/connect/register"}createBasicHeader(e="",s=""){let i=this.config.getClientId()+":"+this.config.getClientSecret();return e&&s&&(i=e+":"+s),o.AuthorizationTokenEnum.BASIC+o.Base64.encode(i)}createClientData(e="",s="",i=""){const n={client_id:"",client_secret:""};return e&&s?(n.client_id=e,n.client_secret=s):(n.client_id=this.config.getClientId(),n.client_secret=this.config.getClientSecret()),i&&c.merge(n,{scope:i}),n}createOAuth2Data(e,s,i=!1){const n={grant_type:e};return c.isEmpty(s)||c.merge(n,s),i&&c.merge(n,{scope:"openid"}),n}signOut(e,s="",i=""){return this.config.getHttp().put(this.getOAuth2SignOutAddress(),{accessToken:e},{contentType:o.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(s,i)}})}revoke(e,s="",i=""){return this.config.getHttp().post(this.getOAuth2RevokeAddress(),{token:e},{contentType:o.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(s,i)}})}refreshTokenFlow(e,s=!1,i="",n=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(o.AuthorizationGrantTypeEnum.REFRESH_TOKEN,{refresh_token:e},s),{contentType:o.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(i,n)}})}passwordFlow(e,s,i=!1,n="",a=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(o.AuthorizationGrantTypeEnum.PASSWORD,{username:e,password:s},i),{contentType:o.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(n,a)}})}authorizationCodeFlow(e,s,i="",n=!1,a="",y=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(o.AuthorizationGrantTypeEnum.AUTHORIZATION_CODE,{code:e,state:i,redirect_uri:s},n),{contentType:o.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(a,y)}})}clientCredentialsFlow(e="",s="",i=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(o.AuthorizationGrantTypeEnum.CLIENT_CREDENTIALS,{...this.createClientData(e,s,i)}),{contentType:o.ContentTypeEnum.URL_ENCODED})}deviceCodeFlow(e,s="",i="",n=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(o.AuthorizationGrantTypeEnum.DEVICE_CODE,{device_code:e,...this.createClientData(s,i,n)}),{contentType:o.ContentTypeEnum.URL_ENCODED})}deviceAuthorizationFlow(e="",s="",i=o.BuildInScopeEnum.EMAIL){return this.config.getHttp().post(this.getOAuth2DeviceAuthorizationAddress(),this.createClientData(e,s,i),{contentType:o.ContentTypeEnum.URL_ENCODED})}socialCredentialsFlowBySms(e,s,i=!1,n="",a=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(o.AuthorizationGrantTypeEnum.SOCIAL_CREDENTIALS,{mobile:e,code:s,source:P.SMS},i),{contentType:o.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(n,a)}})}socialCredentialsFlowByJustAuth(e,s,i=!1,n="",a=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(o.AuthorizationGrantTypeEnum.SOCIAL_CREDENTIALS,{...s,source:e},i),{contentType:o.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(n,a)}})}}class z{static instance=null;config={};constructor(e){this.config=e}static getInstance(e){return this.instance==null&&(this.instance=new z(e)),this.instance}createSession(e=""){const s=this.config.getUaa()+"/open/identity/session";return this.config.getHttp().post(s,{clientId:this.config.getClientId(),clientSecret:this.config.getClientSecret(),sessionId:e})}exchange(e="",s){const i=this.config.getUaa()+"/open/identity/exchange";return this.config.getHttp().post(i,{publicKey:s,sessionId:e})}getPrompt(e){const s=this.config.getUaa()+"/open/identity/prompt";return this.config.getHttp().post(s,{username:e})}createCaptcha(e,s){const i=this.config.getUaa()+"/open/captcha";return this.config.getHttp().get(i,{identity:e,category:s})}verifyCaptcha(e,s,i){const n=this.config.getUaa()+"/open/captcha",a={identity:e,category:s,coordinate:{x:0,y:0},coordinates:[],characters:""};return s===H.WORD_CLICK?a.coordinates=i:s===H.JIGSAW?a.coordinate=i:a.characters=i,this.config.getHttp().post(n,a)}createVerificationCode(e){const s=this.config.getUpms()+"/open/identity/verification-code";return this.config.getHttp().post(s,{mobile:e},{contentType:o.ContentTypeEnum.URL_ENCODED})}getSocialList(){const e=this.config.getUpms()+"/open/identity/sources";return this.config.getHttp().get(e)}}class p{static _instance=null;static _initialized=!1;config={};constructor(e){this.config=e}static initialize(e){if(p._initialized)throw new Error("SecurityApiResources has already been initialized");return p._instance=new p(e),p._initialized=!0,p._instance}static getInstance(){if(!p._instance)throw new Error("SecurityApiResources not initialized. Call initialize() first.");return p._instance}getConfig(){return this.config}open(){return z.getInstance(this.config)}oauth2(){return S.getInstance(this.config)}}const b=N.defineStore("Crypto",{state:()=>({sessionId:"",key:"",state:""}),actions:{setSessionId(t){this.sessionId=t},setKey(t){this.key=o.SM4Utils.encrypt(t,d.getSecurityKey())},getKey(){return o.SM4Utils.decrypt(this.key,d.getSecurityKey())},encrypt(t){const e=this.getKey();return o.SM4Utils.encrypt(t,e)},decrypt(t){const e=this.getKey();return o.SM4Utils.decrypt(t,e)},exchange(t=""){return new Promise((e,s)=>{p.getInstance().open().createSession(t).then(i=>{const n=i.data;if(n){const a=n.sessionId,y=n.publicKey;this.state=n.state;const v=o.SM2Utils.createKeyPair(),l=o.SM2Utils.encrypt(v.publicKey,y);p.getInstance().open().exchange(a,l).then(g=>{const h=g.data,_=o.SM2Utils.decrypt(h,v.privateKey);this.setSessionId(a),this.setKey(_),e(_)})}}).catch(i=>{s(i)})})}},persist:{storage:sessionStorage}}),k=N.defineStore("Authentication",{state:()=>({access_token:"",expires_in:0,refresh_token:"",license:"",openid:"",idToken:"",scope:"",token_type:"",errorTimes:0,remainTimes:0,locked:!1,userId:"",username:"",employeeId:"",avatar:"",roles:[]}),getters:{isNotExpired:t=>{const e=o.moment().add(t.expires_in,"seconds").valueOf();return o.moment(e).add(1,"seconds").diff(o.moment(),"seconds")!==0},token(){return d.isAutoRefreshToken()?this.access_token:this.isNotExpired?this.access_token:""}},actions:{getBearerToken(){return o.AuthorizationTokenEnum.BEARER+this.token},getAuthorizationHeader(){return{Authorization:this.getBearerToken(),"X-Herodotus-Open-Id":this.userId}},saveAccessToken(t){if(this.access_token=t.access_token,this.expires_in=t.expires_in,this.refresh_token=t.refresh_token?t.refresh_token:"",this.license=t.refresh_token?t.refresh_token:"",this.scope=t.scope,this.token_type=t.token_type,t.id_token){this.idToken=t.id_token;const e=F.jwtDecode(this.idToken);this.userId=e.openid,this.username=e.sub,this.avatar=e.avatar,this.employeeId=e.employeeId,this.roles=e.roles}else if(t.openid){const e=b();this.openid=t.openid;const s=e.decrypt(this.openid),i=JSON.parse(s);this.userId=i.userId,this.username=i.username,this.roles=i.roles,this.avatar=i.avatar,this.employeeId=i.employeeId}else console.warn("There is no id token or openid in the data.")},setUserErrorStatus(t){this.remainTimes=t.remainTimes,this.errorTimes=t.errorTimes,this.locked=t.locked},isAlertMessage(t){return t.code&&[40106,40111].includes(t.code)},setErrorPrompt(t,e){this.isAlertMessage(t)&&p.getInstance().open().getPrompt(e).then(s=>{this.setUserErrorStatus(s.data)})},signIn(t,e){const s=b();return d.isUseCrypto()&&(t=s.encrypt(t),e=s.encrypt(e)),new Promise((i,n)=>{p.getInstance().oauth2().passwordFlow(t,e,d.isUseCrypto()).then(a=>{if(a){const y=a;this.saveAccessToken(y)}this.access_token?i(!0):i(!1)}).catch(a=>{this.setErrorPrompt(a,t),n(a)})})},refreshToken(){return new Promise((t,e)=>{p.getInstance().oauth2().refreshTokenFlow(this.refresh_token,d.isUseCrypto()).then(s=>{if(s){const i=s;this.saveAccessToken(i)}this.access_token?t(!0):t(!1)}).catch(s=>{e(s)})})},signOut(){this.access_token&&p.getInstance().oauth2().signOut(this.access_token).then(()=>{console.log("Server side sign out successfully.")}).catch(t=>{console.log("Server side sign out has error.",t)})},authorizationCode(t,e=""){return new Promise((s,i)=>{p.getInstance().oauth2().authorizationCodeFlow(t,d.getRedirectUri(),e,d.isUseCrypto()).then(n=>{if(n){const a=n;this.saveAccessToken(a)}this.access_token?s(!0):s(!1)}).catch(n=>{i(n)})})},smsSignIn(t,e){const s=b();return d.isUseCrypto()&&(t=s.encrypt(t),e=s.encrypt(e)),new Promise((i,n)=>{p.getInstance().oauth2().socialCredentialsFlowBySms(t,e,d.isUseCrypto()).then(a=>{if(a){const y=a;this.saveAccessToken(y)}this.access_token?i(!0):i(!1)}).catch(a=>{this.setErrorPrompt(a,t),n(a)})})},socialSignIn(t,e){return new Promise((s,i)=>{p.getInstance().oauth2().socialCredentialsFlowByJustAuth(t,e,d.isUseCrypto()).then(n=>{if(n){const a=n;this.saveAccessToken(a)}this.access_token?s(!0):s(!1)}).catch(n=>{n.code&&[40106,40111].includes(n.code)&&i(n)})})}},persist:!0}),G=()=>{const t=k(),e=b(),s=t.access_token,i=e.sessionId,n={};s&&(n.Authorization=o.AuthorizationTokenEnum.BEARER+s),i&&(n["X-Herodotus-Session-Id"]=i);const a=d.getTenantId();return a&&(n["X-Herodotus-Tenant-Id"]=a),n},w=N.defineStore("Router",{state:()=>({appMenus:[],personalMenus:[],cachedRoutes:[],details:new Map(new Map),pushParams:{}}),getters:{isDynamicRouteAdded(){return!c.isEmpty(this.appMenus)||!c.isEmpty(this.personalMenus)}},actions:{getDetailComponent(t){return this.details.get(t)},getRoutePushParam(t){return this.pushParams[t]},addMenus(t,e){c.isEmpty(t)||(this.appMenus=t),c.isEmpty(e)||(this.personalMenus=e)},addCachedRoute(t){if(!t.meta?.isNotKeepAlive){const e=t.name;this.cachedRoutes.includes(e)||this.cachedRoutes.push(e)}},addDetailRoute(t){const e=t.name;e&&this.details.set(e,t.component)},hasParameter(t){const e=t.name;return!!(e&&c.has(this.pushParams,e))},isDetailRoute(t){return!!(t.meta&&t.meta.isDetailContent)},isValidDetailRoute(t){return this.isDetailRoute(t)&&this.hasParameter(t)},addRoutePushParam(t,e={}){t&&(this.pushParams[t]=e)},removeRoutePushParam(t){t&&delete this.pushParams[t]}}}),x=N.defineStore("GlobalSettings",{state:()=>({theme:{mode:O.SYSTEM,isMixed:!0,primary:"#1867c0"},layout:L.DEFAULT,effect:{isUniqueOpened:!1},display:{isTabsView:!0,isActivateLeftTab:!0,showBreadcrumbs:!0,showBreadcrumbsIcon:!0,table:{dense:!1}}}),getters:{isDark:t=>t.theme.mode===O.DARK,isLight:t=>t.theme.mode===O.LIGHT,isSystem:t=>t.theme.mode===O.SYSTEM,isDefaultLayout:t=>t.layout===L.DEFAULT,isClassicLayout:t=>t.layout===L.CLASSIC},persist:!0}),M=N.defineStore("TabsView",{state:()=>({tabs:[],activatedTab:{},activatedTabName:""}),getters:{isNotLastTab:t=>e=>t.tabs.length-1!==e,getLastTabIndex:t=>t.tabs.length-1,getTabIndex:t=>e=>c.findIndex(t.tabs,s=>s.name===e.name),getActivatedTabIndex(){return this.getTabIndex(this.activatedTab)},isLastTabActivated(){return this.getActivatedTabIndex===this.getLastTabIndex},isFirstTabActivated(){return this.getActivatedTabIndex===0},disableCloseCurrentTab(){return this.isLastTabActivated||this.isFirstTabActivated},disableCloseLeftTabs(){return this.isFirstTabActivated},disableCloseRightTabs(){return this.isLastTabActivated},disableRefreshCurrentTab(){return!!(this.activatedTab.meta&&this.activatedTab.meta.isDetailContent)}},actions:{convertRouteToTab(t){return{name:t.name,path:t.path,meta:t.meta}},setActivatedTab(t){D.nextTick(()=>{this.activatedTab=t,this.activatedTabName=t.name})},isNotExistInStaticRoute(t){return c.findIndex(d.getRoutes(),e=>e.path===t.path)===-1},isTabNotOpened(t){return this.getTabIndex(t)===-1},openTab(t,e=!1){this.isNotExistInStaticRoute(t)&&(this.isTabNotOpened(t)&&(e?this.isLastTabActivated?this.tabs.splice(this.getActivatedTabIndex,0,t):this.tabs.splice(this.getActivatedTabIndex+1,0,t):this.tabs.push(t)),this.setActivatedTab(t))},closeTab(t){c.remove(this.tabs,e=>e.name===t.name)},smartTab(t){const e=w(),s=e.isDetailRoute(t),i=this.convertRouteToTab(t);s?e.hasParameter(t)?this.openTab(i,s):(this.closeTab(i),m.getInstance().goBack()):this.openTab(i,s)},deleteTab(t){const e=this.convertRouteToTab(t);this.closeTab(e)},closeCurrentTab(){this.closeTab(this.activatedTab)},closeOtherTabs(){c.remove(this.tabs,t=>t.name!==this.activatedTab.name)},closeLeftTabs(){const t=this.getActivatedTabIndex;c.remove(this.tabs,(e,s)=>s<t)},closeRightTabs(){const t=this.getActivatedTabIndex;c.remove(this.tabs,(e,s)=>s>t)}},persist:!0});function W(){const t=B.useRoute(),e=w(),s=M();return{onFinish:()=>{const n=t.name;e.removeRoutePushParam(n),s.deleteTab(t),m.getInstance().goBack()}}}function Y(){w();const t=k(),e=l=>l.meta?.title,s=l=>l.meta?.icon,i=l=>l.meta?.isHideAllChild,n=l=>l.children,a=l=>!!n(l);return{hasPermission:l=>{const g=t.roles,h=l.meta?.roles;if(c.isEmpty(h))return!0;if(c.isEmpty(g))return!1;const _=c.intersection(g,h);return!c.isEmpty(_)},getItemTitle:e,getItemIcon:s,getItemChildren:n,isDisplayAsItem:l=>a(l)?!!i(l):!0}}function V(t,e,s,i){const n=r=>r.meta?.isDetailContent,a=r=>r.meta?.scenario,y=(r,T)=>{const u={};return u.path=r.name,u.component=T[s(r.componentPath)],r.componentName&&(u.name=r.componentName),r.redirect&&(u.redirect=r.redirect),u.meta={scenario:r.scenario,icon:r.meta.icon,title:r.meta.title,...r.meta.sort&&{sort:r.meta.sort},...r.meta.isHaveChild&&{isHaveChild:r.meta.isHaveChild},...r.meta.isNotKeepAlive&&{isNotKeepAlive:r.meta.isNotKeepAlive},...r.meta.isHideAllChild&&{isHideAllChild:r.meta.isHideAllChild},...r.meta.isDetailContent&&{isDetailContent:r.meta.isDetailContent},...r.meta.isIgnoreAuth&&{isIgnoreAuth:r.meta.isIgnoreAuth}},u},v=(r,T)=>{const u=w();return r.map(f=>{const A=y(f,T);return n(A)&&u.addDetailRoute(A),f.children&&f.children.length>0&&(A.children=v(f.children,T)),A})},l=()=>{const r=[],T=t;return Object.keys(T).forEach(u=>{const A=T[u].default||{},I=Array.isArray(A)?[...A]:[A];r.push(...I)}),r},g=(r,T)=>{const u=r.meta?.sort||0,f=T.meta?.sort||0;return u-f},h=(r,T)=>{const u=w();if(console.log("[Herodotus] |- Begin add dynamic routes"),c.isEmpty(T))console.warn("[Herodotus] |- Dynamic routes is empty, skip!");else{const f=[],A=[];T.forEach(I=>{r.addRoute(I),a(I)===U.APP?f.push(I):A.push(I)}),u.addMenus(f,A),console.log("[Herodotus] |- Dynamic routes add success!")}};return{initBackEndRoutes:async(r,T)=>{const f=(await i(T)).data.menus,I=v(f,e);console.log("---routes---",I),h(r,I)},initFrontEndRoutes:async r=>{const u=l().sort(g);console.log(u),h(r,u)}}}function q(){let t;const e=x(),s=D.shallowRef(O.DARK),i=typeof window<"u",n=()=>{if(i)return window.matchMedia("(prefers-color-scheme: dark)")},a=()=>{s.value=t.matches?O.DARK:O.LIGHT},y=g=>{if(!g||g.nodeType!==Node.ELEMENT_NODE)return!1;const h=window.getComputedStyle(g);return h.overflowY==="scroll"||h.overflowY==="auto"&&g.scrollHeight>g.clientHeight},v=()=>{const g=performance.now();if(performance.now()-g>10)return;const h=document.querySelector("[data-v-app]");h.querySelectorAll("*").forEach(E=>{y(E)&&(E.dataset.scrollX=String(E.scrollLeft),E.dataset.scrollY=String(E.scrollTop))});const R=h.cloneNode(!0);R.classList.add("app-copy");const r=h.getBoundingClientRect();R.style.top=r.top+"px",R.style.left=r.left+"px",R.style.width=r.width+"px",R.style.height=r.height+"px";const u=document.activeElement.getBoundingClientRect(),f=u.left+u.width/2+window.scrollX,A=u.top+u.height/2+window.scrollY;h.style.setProperty("--clip-pos",`${f}px ${A}px`),h.style.removeProperty("--clip-size"),D.nextTick(()=>{h.classList.add("app-transition"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{h.style.setProperty("--clip-size",Math.hypot(window.innerWidth,window.innerHeight)+"px")})})}),document.body.append(R),R.querySelectorAll("[data-scroll-x], [data-scroll-y]").forEach(E=>{E.scrollLeft=Number(E.dataset.scrollX),E.scrollTop=Number(E.dataset.scrollY)});function I(E){E.target===E.currentTarget&&(R.remove(),h.removeEventListener("transitionend",I),h.removeEventListener("transitioncancel",I),h.classList.remove("app-transition"),h.style.removeProperty("--clip-size"),h.style.removeProperty("--clip-pos"))}h.addEventListener("transitionend",I),h.addEventListener("transitioncancel",I)};D.watch(()=>e.theme.mode,g=>{g===O.SYSTEM?(t=n(),t.addEventListener("change",a),a()):t&&t.removeEventListener("change",a)},{immediate:!0});const l=D.computed(()=>e.isSystem?s.value:e.theme.mode);return D.watch(l,v),{theme:l}}const X=t=>{d.initialize(t),m.initialize(t.router),p.initialize(t.config),C.initialize(t.signOutExtension)};exports.CaptchaCategoryEnum=H;exports.LayoutModeEnum=L;exports.MenuScenario=U;exports.OptionsUtilities=d;exports.RouterUtilities=m;exports.SecurityApiResources=p;exports.SignOutUtilities=C;exports.SocialSourceEnum=P;exports.ThemeModeEnum=O;exports.getSystemHeaders=G;exports.initializer=X;exports.useApplicationStore=K;exports.useAuthenticationStore=k;exports.useCryptoStore=b;exports.useEditFinish=W;exports.useRouterStore=w;exports.useSettingsStore=x;exports.useSystemMenu=Y;exports.useSystemRoute=V;exports.useSystemTheme=q;exports.useTabsViewStore=M;
