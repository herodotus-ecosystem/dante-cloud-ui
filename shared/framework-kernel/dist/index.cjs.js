"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const K=require("vue-router"),P=require("pinia"),i=require("@herodotus-cloud/core"),M=require("jwt-decode"),m=require("vue");require("pinia-plugin-persistedstate");var N=(t=>(t.DEFAULT="defaults",t.CLASSIC="classic",t.TRANSVERSE="transverse",t.COLUMNS="transverse",t))(N||{}),b=(t=>(t.DARK="dark",t.LIGHT="light",t.SYSTEM="system",t))(b||{}),k=(t=>(t.JIGSAW="JIGSAW",t.WORD_CLICK="WORD_CLICK",t.ARITHMETIC="ARITHMETIC",t.CHINESE="CHINESE",t.CHINESE_GIF="CHINESE_GIF",t.SPEC_GIF="SPEC_GIF",t.SPEC="SPEC",t.HUTOOL_LINE="HUTOOL_LINE",t.HUTOOL_CIRCLE="HUTOOL_CIRCLE",t.HUTOOL_SHEAR="HUTOOL_SHEAR",t.HUTOOL_GIF="HUTOOL_GIF",t))(k||{}),L=(t=>(t.INSTITUTION="INSTITUTION",t.SMS="SMS",t.WXAPP="WXAPP",t.QQ="QQ",t.WEIBO="WEIBO",t.BAIDU="BAIDU",t.WECHAT_OPEN="WECHAT_OPEN",t.WECHAT_MP="WECHAT_MP",t.WECHAT_ENTERPRISE="WECHAT_ENTERPRISE",t.WECHAT_ENTERPRISE_WEB="WECHAT_ENTERPRISE_WEB",t.DINGTALK="DINGTALK",t.DINGTALK_ACCOUNT="DINGTALK_ACCOUNT",t.ALIYUN="ALIYUN",t.TAOBAO="TAOBAO",t.ALIPAY="ALIPAY",t.TEAMBITION="TEAMBITION",t.HUAWEI_V2="HUAWEI_V2",t.FEISHU="FEISHU",t.JD="JD",t.DOUYIN="DOUYIN",t.TOUTIAO="TOUTIAO",t.MI="MI",t.RENREN="RENREN",t.MEITUAN="MEITUAN",t.ELEME="ELEME",t.KUJIALE="KUJIALE",t.XMLY="XMLY",t.GITEE="GITEE",t.OSCHINA="OSCHINA",t.CSDN="CSDN",t.GITHUB="GITHUB",t.GITLAB="GITLAB",t.STACK_OVERFLOW="STACK_OVERFLOW",t.CODING="CODING",t.GOOGLE="GOOGLE",t.MICROSOFT="MICROSOFT",t.FACEBOOK="FACEBOOK",t.LINKEDIN="LINKEDIN",t.TWITTER="TWITTER",t.AMAZON="AMAZON",t.SLACK="SLACK",t.LINE="LINE",t.OKTA="OKTA",t.PINTEREST="PINTEREST",t))(L||{}),H=(t=>(t.APP="APP",t.PERSONAL="PERSONAL",t))(H||{});const F=P.defineStore("Application",{state:()=>({leftDrawer:!0,rightDrawer:!1,signInPanel:"account"}),actions:{switchToMobilePanel(){this.signInPanel="mobile"},switchToScanPanel(){this.signInPanel="scan"},switchToAccountPanel(){this.signInPanel="account"}}});class p{static _instance=null;static _initialized=!1;options;constructor(e){this.options=e}static initialize(e){if(p._initialized)throw new Error("RouterUtilities has already been initialized");return p._instance=new p(e),p._initialized=!0,p._instance}static getInstance(){if(!p._instance)throw new Error("RouterUtilities not initialized. Call initialize() first.");return p._instance}setOptions(e){this.options=e}getOptions(){return this.options}static axiosConfig(){return this.getInstance().getOptions().config}static getRouterOptions(){return this.getInstance().getOptions().router}static getRouter(){return this.getRouterOptions().instance}static getRoutes(){return this.getInstance().getOptions().staticRoutes}static getSecurityKey(){return this.getInstance().getOptions().variables.securityKey}static getRedirectUri(){return this.getInstance().getOptions().variables.redirectUri}static isUseCrypto(){return this.getInstance().getOptions().variables.isUseCrypto}static isAutoRefreshToken(){return this.getInstance().getOptions().variables.isAutoRefreshToken}static getTenantId(){return this.getInstance().getOptions().variables.tenantId}}class E{static _instance=null;static _initialized=!1;options;router={};constructor(e){this.options=e,this.router=e.instance}static initialize(e){if(E._initialized)throw new Error("RouterUtilities has already been initialized");return E._instance=new E(e),E._initialized=!0,E._instance}static getInstance(){if(!E._instance)throw new Error("RouterUtilities not initialized. Call initialize() first.");return E._instance}setRouter(e){this.router=e}getRouter(){return this.router}isRouterExist(){return!i.lodash.isEmpty(this.router)}hasParameter(e){return!i.lodash.isEmpty(e.params)||!i.lodash.isEmpty(e.query)}isDetailRoute(e){return!!(e.meta&&e.meta.isDetailContent)}isValidDetailRoute(e){return this.isDetailRoute(e)&&this.hasParameter(e)}push(e){return this.router.push(e)}replace(e){return this.router.replace(e)}to(e,s=!1){s?this.push(e):this.replace(e)}open(e){const s=this.router.resolve(e);window.open(s.href,"_blank")}goBack(){this.router.go(-1)}refresh(){this.isRouterExist()?this.router.go(0):window.location.reload()}toRoot(){this.isRouterExist()&&this.to(this.options.path.root)}toHome(){this.isRouterExist()&&this.to(this.options.path.home)}toSignIn(){this.isRouterExist()?this.to(this.options.path.signIn):this.refresh()}getParent(e){const s=i.lodash.split(e,"/"),n=i.lodash.dropRight(s);return i.lodash.join(n,"/")}toPrev(e){if(e.path){const s=this.getParent(e.path);this.to({path:s})}else this.goBack()}}class R{static _instance=null;static _initialized=!1;extension;constructor(e){this.extension=e}static initialize(e){if(R._initialized)throw new Error("SignOutUtilities has already been initialized");return R._instance=new R(e),R._initialized=!0,R._instance}static getInstance(){if(!R._instance)throw new Error("SignOutUtilities not initialized. Call initialize() first.");return R._instance}signOut(e=!1){e||_().signOut(),this.extension(),console.log("Clear Framework Kernel Data"),_().$reset(),w().$reset(),E.getInstance().toSignIn()}signOutWithDialog(){i.Swal.fire({title:"要走了么?",text:"您确定要退出系统！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的",cancelButtonText:"取消"}).then(e=>{e.value&&this.signOut()})}tokenExpires(e,s,n,a=!1){i.Swal.fire({title:e,text:s,icon:n,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"},confirmButtonText:"已阅!",willClose:()=>{this.signOut(a)}})}}class U{static instance=null;config={};constructor(e){this.config=e}static getInstance(e){return this.instance==null&&(this.instance=new U(e)),this.instance}getOAuth2TokenAddress(){return this.config.getUaa()+"/oauth2/token"}getOAuth2RevokeAddress(){return this.config.getUaa()+"/oauth2/revoke"}getOAuth2SignOutAddress(){return this.config.getUaa()+"/oauth2/sign-out"}getOAuth2DeviceAuthorizationAddress(){return this.config.getUaa()+"/oauth2/device_authorization"}getOIDCConnectRegisterAddress(){return this.config.getUaa()+"/connect/register"}createBasicHeader(e="",s=""){let n=this.config.getClientId()+":"+this.config.getClientSecret();return e&&s&&(n=e+":"+s),i.AuthorizationTokenEnum.BASIC+i.Base64.encode(n)}createClientData(e="",s="",n=""){const a={client_id:"",client_secret:""};return e&&s?(a.client_id=e,a.client_secret=s):(a.client_id=this.config.getClientId(),a.client_secret=this.config.getClientSecret()),n&&i.lodash.merge(a,{scope:n}),a}createOAuth2Data(e,s,n=!1){const a={grant_type:e};return i.lodash.isEmpty(s)||i.lodash.merge(a,s),n&&i.lodash.merge(a,{scope:"openid"}),a}signOut(e,s="",n=""){return this.config.getHttp().put(this.getOAuth2SignOutAddress(),{accessToken:e},{contentType:i.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(s,n)}})}revoke(e,s="",n=""){return this.config.getHttp().post(this.getOAuth2RevokeAddress(),{token:e},{contentType:i.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(s,n)}})}refreshTokenFlow(e,s=!1,n="",a=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.REFRESH_TOKEN,{refresh_token:e},s),{contentType:i.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(n,a)}})}passwordFlow(e,s,n=!1,a="",r=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.PASSWORD,{username:e,password:s},n),{contentType:i.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(a,r)}})}authorizationCodeFlow(e,s,n="",a=!1,r="",T=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.AUTHORIZATION_CODE,{code:e,state:n,redirect_uri:s},a),{contentType:i.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(r,T)}})}clientCredentialsFlow(e="",s="",n=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.CLIENT_CREDENTIALS,{...this.createClientData(e,s,n)}),{contentType:i.ContentTypeEnum.URL_ENCODED})}deviceCodeFlow(e,s="",n="",a=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.DEVICE_CODE,{device_code:e,...this.createClientData(s,n,a)}),{contentType:i.ContentTypeEnum.URL_ENCODED})}deviceAuthorizationFlow(e="",s="",n=i.BuildInScopeEnum.EMAIL){return this.config.getHttp().post(this.getOAuth2DeviceAuthorizationAddress(),this.createClientData(e,s,n),{contentType:i.ContentTypeEnum.URL_ENCODED})}socialCredentialsFlowBySms(e,s,n=!1,a="",r=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.SOCIAL_CREDENTIALS,{mobile:e,code:s,source:L.SMS},n),{contentType:i.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(a,r)}})}socialCredentialsFlowByJustAuth(e,s,n=!1,a="",r=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.SOCIAL_CREDENTIALS,{...s,source:e},n),{contentType:i.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(a,r)}})}webAuthnCredentialsFlow(e,s=!1,n="",a=""){return this.config.getHttp().postWithParams(this.getOAuth2TokenAddress(),this.createOAuth2Data(i.AuthorizationGrantTypeEnum.WEBAUTHN_CREDENTIALS,{},s),{...e},{contentType:i.ContentTypeEnum.JSON},{headers:{Authorization:this.createBasicHeader(n,a)}})}oidcClientRegistrationFlow(e,s){return this.config.getHttp().post(this.getOIDCConnectRegisterAddress(),{product_key:e,grant_types:[i.AuthorizationGrantTypeEnum.CLIENT_CREDENTIALS,i.AuthorizationGrantTypeEnum.DEVICE_CODE],redirect_uris:["http://192.168.101.10:3000"],client_name:s,scope:[i.BuildInScopeEnum.OPENID,i.BuildInScopeEnum.EMAIL,i.BuildInScopeEnum.PROFILE].join(" "),response_types:["token"],token_endpoint_auth_method:i.ClientAuthenticationMethodEnum.CLIENT_SECRET_POST})}}class S{static instance=null;config={};constructor(e){this.config=e}static getInstance(e){return this.instance==null&&(this.instance=new S(e)),this.instance}createSession(e=""){const s=this.config.getUaa()+"/open/identity/session";return this.config.getHttp().post(s,{clientId:this.config.getClientId(),clientSecret:this.config.getClientSecret(),sessionId:e})}exchange(e="",s){const n=this.config.getUaa()+"/open/identity/exchange";return this.config.getHttp().post(n,{publicKey:s,sessionId:e})}getPrompt(e){const s=this.config.getUaa()+"/open/identity/prompt";return this.config.getHttp().post(s,{username:e})}createCaptcha(e,s){const n=this.config.getUaa()+"/open/captcha";return this.config.getHttp().get(n,{identity:e,category:s})}verifyCaptcha(e,s,n){const a=this.config.getUaa()+"/open/captcha",r={identity:e,category:s,coordinate:{x:0,y:0},coordinates:[],characters:""};return s===k.WORD_CLICK?r.coordinates=n:s===k.JIGSAW?r.coordinate=n:r.characters=n,this.config.getHttp().post(a,r)}createVerificationCode(e){const s=this.config.getUpms()+"/open/identity/verification-code";return this.config.getHttp().post(s,{mobile:e},{contentType:i.ContentTypeEnum.URL_ENCODED})}getSocialList(){const e=this.config.getUpms()+"/open/identity/sources";return this.config.getHttp().get(e)}}class z extends i.Service{static instance=null;constructor(e){super(e)}static getInstance(e){return this.instance==null&&(this.instance=new z(e)),this.instance}getBaseAddress(){return this.getConfig().getUaa()+"/webauthn/register"}getPublicKeyCredentialCreationOptionsAddress(){return this.getBaseAddress()+"/options"}getWebAuthnAuthenticateAddress(){return this.getConfig().getUaa()+"/login/webauthn"}getPublicKeyCredentialRequestOptionsAddress(){return this.getConfig().getUaa()+"/webauthn/authenticate/options"}getIdPath(e){return this.getParamPath(this.getBaseAddress(),e)}getPublicKeyCredentialCreationOptions(){return this.getConfig().getHttp().post(this.getPublicKeyCredentialCreationOptionsAddress(),"")}webAuthnRegister(e){return this.getConfig().getHttp().post(this.getBaseAddress(),e)}getPublicKeyCredentialRequestOptions(){return this.getConfig().getHttp().post(this.getPublicKeyCredentialRequestOptionsAddress(),"")}webAuthnAuthenticate(e){return this.getConfig().getHttp().post(this.getWebAuthnAuthenticateAddress(),e)}delete(e){return this.getConfig().getHttp().delete(this.getIdPath(e))}}class g{static _instance=null;static _initialized=!1;config={};constructor(e){this.config=e}static initialize(e){if(g._initialized)throw new Error("SecurityApiResources has already been initialized");return g._instance=new g(e),g._initialized=!0,g._instance}static getInstance(){if(!g._instance)throw new Error("SecurityApiResources not initialized. Call initialize() first.");return g._instance}getConfig(){return this.config}open(){return S.getInstance(this.config)}oauth2(){return U.getInstance(this.config)}passkey(){return z.getInstance(this.config)}}const w=P.defineStore("Crypto",{state:()=>({sessionId:"",key:"",state:""}),actions:{setSessionId(t){this.sessionId=t},setKey(t){this.key=i.SM4Utils.encrypt(t,p.getSecurityKey())},getKey(){return i.SM4Utils.decrypt(this.key,p.getSecurityKey())},encrypt(t){const e=this.getKey();return i.SM4Utils.encrypt(t,e)},decrypt(t){const e=this.getKey();return i.SM4Utils.decrypt(t,e)},exchange(t=""){return new Promise((e,s)=>{g.getInstance().open().createSession(t).then(n=>{const a=n.data;if(a){const r=a.sessionId,T=a.publicKey;this.state=a.state;const A=i.SM2Utils.createKeyPair(),c=i.SM2Utils.encrypt(A.publicKey,T);g.getInstance().open().exchange(r,c).then(l=>{const h=l.data,v=i.SM2Utils.decrypt(h,A.privateKey);this.setSessionId(r),this.setKey(v),e(v)})}}).catch(n=>{s(n)})})}},persist:{storage:sessionStorage}}),_=P.defineStore("Authentication",{state:()=>({access_token:"",expires_in:0,refresh_token:"",license:"",openid:"",idToken:"",scope:"",token_type:"",errorTimes:0,remainTimes:0,locked:!1,userId:"",username:"",employeeId:"",avatar:"",roles:[]}),getters:{isNotExpired:t=>{const e=i.moment().add(t.expires_in,"seconds").valueOf();return i.moment(e).add(1,"seconds").diff(i.moment(),"seconds")!==0},token(){return p.isAutoRefreshToken()?this.access_token:this.isNotExpired?this.access_token:""}},actions:{getBearerToken(){return i.AuthorizationTokenEnum.BEARER+this.token},getAuthorizationHeader(){return{Authorization:this.getBearerToken(),"X-Herodotus-Open-Id":this.userId}},saveAccessToken(t){if(this.access_token=t.access_token,this.expires_in=t.expires_in,this.refresh_token=t.refresh_token?t.refresh_token:"",this.license=t.refresh_token?t.refresh_token:"",this.scope=t.scope,this.token_type=t.token_type,t.id_token){this.idToken=t.id_token;const e=M.jwtDecode(this.idToken);this.userId=e.openid,this.username=e.sub,this.avatar=e.avatar,this.employeeId=e.employeeId,this.roles=e.roles}else if(t.openid){const e=w();this.openid=t.openid;const s=e.decrypt(this.openid),n=JSON.parse(s);this.userId=n.userId,this.username=n.username,this.roles=n.roles,this.avatar=n.avatar,this.employeeId=n.employeeId}else console.warn("There is no id token or openid in the data.")},setUserErrorStatus(t){this.remainTimes=t.remainTimes,this.errorTimes=t.errorTimes,this.locked=t.locked},isAlertMessage(t){return t.code&&[40106,40111].includes(t.code)},setErrorPrompt(t,e){this.isAlertMessage(t)&&g.getInstance().open().getPrompt(e).then(s=>{this.setUserErrorStatus(s.data)})},signIn(t,e){const s=w();return p.isUseCrypto()&&(t=s.encrypt(t),e=s.encrypt(e)),new Promise((n,a)=>{g.getInstance().oauth2().passwordFlow(t,e,p.isUseCrypto()).then(r=>{if(r){const T=r;this.saveAccessToken(T)}this.access_token?n(!0):n(!1)}).catch(r=>{this.setErrorPrompt(r,t),a(r)})})},refreshToken(){return new Promise((t,e)=>{g.getInstance().oauth2().refreshTokenFlow(this.refresh_token,p.isUseCrypto()).then(s=>{if(s){const n=s;this.saveAccessToken(n)}this.access_token?t(!0):t(!1)}).catch(s=>{e(s)})})},signOut(){this.access_token&&g.getInstance().oauth2().signOut(this.access_token).then(()=>{console.log("Server side sign out successfully.")}).catch(t=>{console.log("Server side sign out has error.",t)})},authorizationCode(t,e=""){return new Promise((s,n)=>{g.getInstance().oauth2().authorizationCodeFlow(t,p.getRedirectUri(),e,p.isUseCrypto()).then(a=>{if(a){const r=a;this.saveAccessToken(r)}this.access_token?s(!0):s(!1)}).catch(a=>{n(a)})})},smsSignIn(t,e){const s=w();return p.isUseCrypto()&&(t=s.encrypt(t),e=s.encrypt(e)),new Promise((n,a)=>{g.getInstance().oauth2().socialCredentialsFlowBySms(t,e,p.isUseCrypto()).then(r=>{if(r){const T=r;this.saveAccessToken(T)}this.access_token?n(!0):n(!1)}).catch(r=>{this.setErrorPrompt(r,t),a(r)})})},socialSignIn(t,e){return new Promise((s,n)=>{g.getInstance().oauth2().socialCredentialsFlowByJustAuth(t,e,p.isUseCrypto()).then(a=>{if(a){const r=a;this.saveAccessToken(r)}this.access_token?s(!0):s(!1)}).catch(a=>{a.code&&[40106,40111].includes(a.code)&&n(a)})})},passkey(t){return new Promise((e,s)=>{g.getInstance().oauth2().webAuthnCredentialsFlow(t,p.isUseCrypto()).then(n=>{if(n){const a=n;this.saveAccessToken(a)}this.access_token?e(!0):e(!1)}).catch(n=>{n.code&&[40106,40111].includes(n.code)&&s(n)})})}},persist:!0}),G=()=>{const t=_(),e=w(),s=t.access_token,n=e.sessionId,a={};s&&(a.Authorization=i.AuthorizationTokenEnum.BEARER+s),n&&(a["X-Herodotus-Session-Id"]=n);const r=p.getTenantId();return r&&(a["X-Herodotus-Tenant-Id"]=r),a},D=P.defineStore("Router",{state:()=>({appMenus:[],personalMenus:[],cachedRoutes:[],details:new Map(new Map),pushParams:{}}),getters:{isDynamicRouteAdded(){return!i.lodash.isEmpty(this.appMenus)||!i.lodash.isEmpty(this.personalMenus)}},actions:{getDetailComponent(t){return this.details.get(t)},getRoutePushParam(t){return this.pushParams[t]},addMenus(t,e){i.lodash.isEmpty(t)||(this.appMenus=t),i.lodash.isEmpty(e)||(this.personalMenus=e)},addCachedRoute(t){if(!t.meta?.isNotKeepAlive){const e=t.name;this.cachedRoutes.includes(e)||this.cachedRoutes.push(e)}},addDetailRoute(t){const e=t.name;e&&this.details.set(e,t.component)},hasParameter(t){const e=t.name;return!!(e&&i.lodash.has(this.pushParams,e))},isDetailRoute(t){return!!(t.meta&&t.meta.isDetailContent)},isValidDetailRoute(t){return this.isDetailRoute(t)&&this.hasParameter(t)},addRoutePushParam(t,e={}){t&&(this.pushParams[t]=e)},removeRoutePushParam(t){t&&delete this.pushParams[t]}}}),x=P.defineStore("GlobalSettings",{state:()=>({theme:{mode:b.SYSTEM,isMixed:!0,primary:"#1867c0"},layout:N.DEFAULT,effect:{isUniqueOpened:!1},display:{isTabsView:!0,isActivateLeftTab:!0,showBreadcrumbs:!0,showBreadcrumbsIcon:!0,table:{dense:!1}}}),getters:{isDark:t=>t.theme.mode===b.DARK,isLight:t=>t.theme.mode===b.LIGHT,isSystem:t=>t.theme.mode===b.SYSTEM,isDefaultLayout:t=>t.layout===N.DEFAULT,isClassicLayout:t=>t.layout===N.CLASSIC},persist:!0}),B=P.defineStore("TabsView",{state:()=>({tabs:[],activatedTab:{},activatedTabName:""}),getters:{isNotLastTab:t=>e=>t.tabs.length-1!==e,getLastTabIndex:t=>t.tabs.length-1,getTabIndex:t=>e=>i.lodash.findIndex(t.tabs,s=>s.name===e.name),getActivatedTabIndex(){return this.getTabIndex(this.activatedTab)},isLastTabActivated(){return this.getActivatedTabIndex===this.getLastTabIndex},isFirstTabActivated(){return this.getActivatedTabIndex===0},disableCloseCurrentTab(){return this.isLastTabActivated||this.isFirstTabActivated},disableCloseLeftTabs(){return this.isFirstTabActivated},disableCloseRightTabs(){return this.isLastTabActivated},disableRefreshCurrentTab(){return!!(this.activatedTab.meta&&this.activatedTab.meta.isDetailContent)}},actions:{convertRouteToTab(t){return{name:t.name,path:t.path,meta:t.meta}},setActivatedTab(t){m.nextTick(()=>{this.activatedTab=t,this.activatedTabName=t.name})},isNotExistInStaticRoute(t){return i.lodash.findIndex(p.getRoutes(),e=>e.path===t.path)===-1},isTabNotOpened(t){return this.getTabIndex(t)===-1},openTab(t,e=!1){this.isNotExistInStaticRoute(t)&&(this.isTabNotOpened(t)&&(e?this.isLastTabActivated?this.tabs.splice(this.getActivatedTabIndex,0,t):this.tabs.splice(this.getActivatedTabIndex+1,0,t):this.tabs.push(t)),this.setActivatedTab(t))},closeTab(t){i.lodash.remove(this.tabs,e=>e.name===t.name)},smartTab(t){const e=D(),s=e.isDetailRoute(t),n=this.convertRouteToTab(t);s?e.hasParameter(t)?this.openTab(n,s):(this.closeTab(n),E.getInstance().goBack()):this.openTab(n,s)},deleteTab(t){const e=this.convertRouteToTab(t);this.closeTab(e)},closeCurrentTab(){this.closeTab(this.activatedTab)},closeOtherTabs(){i.lodash.remove(this.tabs,t=>t.name!==this.activatedTab.name)},closeLeftTabs(){const t=this.getActivatedTabIndex;i.lodash.remove(this.tabs,(e,s)=>s<t)},closeRightTabs(){const t=this.getActivatedTabIndex;i.lodash.remove(this.tabs,(e,s)=>s>t)}},persist:!0});function W(){const t=K.useRoute(),e=D(),s=B();return{onFinish:()=>{const a=t.name;e.removeRoutePushParam(a),s.deleteTab(t),E.getInstance().goBack()}}}function q(t,e,s,n=""){const a=m.shallowRef(0),r=m.shallowRef(5),T=m.shallowRef(!1),A=m.shallowRef(!1),c=m.shallowRef({}),l=m.ref([]),h=(d,C=!1)=>{const I=l.value.length+1;C?l.value.push({id:I,icon:"mdi-information",color:"green",text:d}):l.value.push({id:I,icon:"mdi-alert-circle",color:"error",text:d})},v=d=>{d==="authorization_pending"?h("Authorization pending, continuing to poll..."):d==="slow_down"?(h("Slowing down..."),u()):d==="token_expired"?(h("Token expired, stopping..."),f(),A.value=!0):d==="access_denied"&&(h("Access denied, stopping..."),f(),A.value=!0)},O=()=>{g.getInstance().oauth2().deviceCodeFlow(t.value,e.value,s.value,n).then(d=>{h("Authorization successful",!0),f(),T.value=!0,c.value=d}).catch(d=>{v(d.error)})},o=()=>{a.value=window.setInterval(O,r.value*1e3)},f=()=>{window.clearInterval(a.value)},u=()=>{r.value+=5,f(),o()};return{pullingResponse:l,successResponse:c,isFailed:A,isSuccess:T,schedule:o,clear:f,slowDown:u}}function V(){D();const t=_(),e=c=>c.meta?.title,s=c=>c.meta?.icon,n=c=>c.meta?.isHideAllChild,a=c=>c.children,r=c=>!!a(c);return{hasPermission:c=>{const l=t.roles,h=c.meta?.roles;if(i.lodash.isEmpty(h))return!0;if(i.lodash.isEmpty(l))return!1;const v=i.lodash.intersection(l,h);return!i.lodash.isEmpty(v)},getItemTitle:e,getItemIcon:s,getItemChildren:a,isDisplayAsItem:c=>r(c)?!!n(c):!0}}function Y(){const t=_();let e=null;const s=()=>{e&&(e=null)};return{isSupported:async()=>!!(window.PublicKeyCredential&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable&&PublicKeyCredential.isConditionalMediationAvailable&&(await Promise.all([PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable(),PublicKeyCredential.isConditionalMediationAvailable()])).every(A=>A===!0)),registration:T=>(e=new AbortController,new Promise((A,c)=>{g.getInstance().passkey().getPublicKeyCredentialCreationOptions().then(l=>{const h=PublicKeyCredential.parseCreationOptionsFromJSON(l);return navigator.credentials.create({publicKey:h})}).then(l=>{const h={publicKey:{label:T,credential:l}};return g.getInstance().passkey().webAuthnRegister(h)}).then(l=>{A(l)}).catch(l=>{c(l)}).finally(()=>{s()})})),authenticator:()=>(e=new AbortController,new Promise((T,A)=>{g.getInstance().passkey().getPublicKeyCredentialRequestOptions().then(c=>{const l=PublicKeyCredential.parseRequestOptionsFromJSON(c);return navigator.credentials.get({publicKey:l,signal:e?.signal})}).then(c=>{if(e?.signal.aborted)return!1;if(c){const l=c;return t.passkey(l.toJSON())}return!1}).then(c=>{T(c)}).catch(c=>{A(c)}).finally(()=>{s()})}))}}function J(t,e,s,n){const a=o=>o.meta?.isDetailContent,r=o=>o.meta?.scenario,T=(o,f)=>{const u={};return u.path=o.name,u.component=f[s(o.componentPath)],o.componentName&&(u.name=o.componentName),o.redirect&&(u.redirect=o.redirect),u.meta={scenario:o.scenario,icon:o.meta.icon,title:o.meta.title,...o.meta.sort&&{sort:o.meta.sort},...o.meta.isHaveChild&&{isHaveChild:o.meta.isHaveChild},...o.meta.isNotKeepAlive&&{isNotKeepAlive:o.meta.isNotKeepAlive},...o.meta.isHideAllChild&&{isHideAllChild:o.meta.isHideAllChild},...o.meta.isDetailContent&&{isDetailContent:o.meta.isDetailContent},...o.meta.isIgnoreAuth&&{isIgnoreAuth:o.meta.isIgnoreAuth}},u},A=(o,f)=>{const u=D();return o.map(d=>{const C=T(d,f);return a(C)&&u.addDetailRoute(C),d.children&&d.children.length>0&&(C.children=A(d.children,f)),C})},c=()=>{const o=[],f=t;return Object.keys(f).forEach(u=>{const C=f[u].default||{},I=Array.isArray(C)?[...C]:[C];o.push(...I)}),o},l=(o,f)=>{const u=o.meta?.sort||0,d=f.meta?.sort||0;return u-d},h=(o,f)=>{const u=D();if(console.log("[Herodotus] |- Begin add dynamic routes"),i.lodash.isEmpty(f))console.warn("[Herodotus] |- Dynamic routes is empty, skip!");else{const d=[],C=[];f.forEach(I=>{o.addRoute(I),r(I)===H.APP?d.push(I):C.push(I)}),u.addMenus(d,C),console.log("[Herodotus] |- Dynamic routes add success!")}};return{initBackEndRoutes:async(o,f)=>{const d=(await n(f)).data.menus,I=A(d,e);console.log("---routes---",I),h(o,I)},initFrontEndRoutes:async o=>{const u=c().sort(l);console.log(u),h(o,u)}}}function X(){let t;const e=x(),s=m.shallowRef(b.DARK),n=typeof window<"u",a=()=>{if(n)return window.matchMedia("(prefers-color-scheme: dark)")},r=()=>{s.value=t.matches?b.DARK:b.LIGHT},T=l=>{if(!l||l.nodeType!==Node.ELEMENT_NODE)return!1;const h=window.getComputedStyle(l);return h.overflowY==="scroll"||h.overflowY==="auto"&&l.scrollHeight>l.clientHeight},A=()=>{const l=performance.now();if(performance.now()-l>10)return;const h=document.querySelector("[data-v-app]");h.querySelectorAll("*").forEach(y=>{T(y)&&(y.dataset.scrollX=String(y.scrollLeft),y.dataset.scrollY=String(y.scrollTop))});const O=h.cloneNode(!0);O.classList.add("app-copy");const o=h.getBoundingClientRect();O.style.top=o.top+"px",O.style.left=o.left+"px",O.style.width=o.width+"px",O.style.height=o.height+"px";const u=document.activeElement.getBoundingClientRect(),d=u.left+u.width/2+window.scrollX,C=u.top+u.height/2+window.scrollY;h.style.setProperty("--clip-pos",`${d}px ${C}px`),h.style.removeProperty("--clip-size"),m.nextTick(()=>{h.classList.add("app-transition"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{h.style.setProperty("--clip-size",Math.hypot(window.innerWidth,window.innerHeight)+"px")})})}),document.body.append(O),O.querySelectorAll("[data-scroll-x], [data-scroll-y]").forEach(y=>{y.scrollLeft=Number(y.dataset.scrollX),y.scrollTop=Number(y.dataset.scrollY)});function I(y){y.target===y.currentTarget&&(O.remove(),h.removeEventListener("transitionend",I),h.removeEventListener("transitioncancel",I),h.classList.remove("app-transition"),h.style.removeProperty("--clip-size"),h.style.removeProperty("--clip-pos"))}h.addEventListener("transitionend",I),h.addEventListener("transitioncancel",I)};m.watch(()=>e.theme.mode,l=>{l===b.SYSTEM?(t=a(),t.addEventListener("change",r),r()):t&&t.removeEventListener("change",r)},{immediate:!0});const c=m.computed(()=>e.isSystem?s.value:e.theme.mode);return m.watch(c,A),{theme:c}}const j=t=>{p.initialize(t),E.initialize(t.router),g.initialize(t.config),R.initialize(t.signOutExtension)};exports.CaptchaCategoryEnum=k;exports.LayoutModeEnum=N;exports.MenuScenario=H;exports.OptionsUtilities=p;exports.RouterUtilities=E;exports.SecurityApiResources=g;exports.SignOutUtilities=R;exports.SocialSourceEnum=L;exports.ThemeModeEnum=b;exports.getSystemHeaders=G;exports.initializer=j;exports.useApplicationStore=F;exports.useAuthenticationStore=_;exports.useCryptoStore=w;exports.useDeviceAuthorize=q;exports.useEditFinish=W;exports.usePasskey=Y;exports.useRouterStore=D;exports.useSettingsStore=x;exports.useSystemMenu=V;exports.useSystemRoute=J;exports.useSystemTheme=X;exports.useTabsViewStore=B;
