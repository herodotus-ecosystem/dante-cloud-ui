"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const M=require("vue-router"),w=require("pinia"),a=require("@herodotus-cloud/core"),B=require("jwt-decode"),_=require("vue");require("pinia-plugin-persistedstate");var N=(t=>(t.DEFAULT="defaults",t.CLASSIC="classic",t.TRANSVERSE="transverse",t.COLUMNS="transverse",t))(N||{}),C=(t=>(t.DARK="dark",t.LIGHT="light",t.SYSTEM="system",t))(C||{}),k=(t=>(t.JIGSAW="JIGSAW",t.WORD_CLICK="WORD_CLICK",t.ARITHMETIC="ARITHMETIC",t.CHINESE="CHINESE",t.CHINESE_GIF="CHINESE_GIF",t.SPEC_GIF="SPEC_GIF",t.SPEC="SPEC",t.HUTOOL_LINE="HUTOOL_LINE",t.HUTOOL_CIRCLE="HUTOOL_CIRCLE",t.HUTOOL_SHEAR="HUTOOL_SHEAR",t.HUTOOL_GIF="HUTOOL_GIF",t))(k||{}),H=(t=>(t.INSTITUTION="INSTITUTION",t.SMS="SMS",t.WXAPP="WXAPP",t.QQ="QQ",t.WEIBO="WEIBO",t.BAIDU="BAIDU",t.WECHAT_OPEN="WECHAT_OPEN",t.WECHAT_MP="WECHAT_MP",t.WECHAT_ENTERPRISE="WECHAT_ENTERPRISE",t.WECHAT_ENTERPRISE_WEB="WECHAT_ENTERPRISE_WEB",t.DINGTALK="DINGTALK",t.DINGTALK_ACCOUNT="DINGTALK_ACCOUNT",t.ALIYUN="ALIYUN",t.TAOBAO="TAOBAO",t.ALIPAY="ALIPAY",t.TEAMBITION="TEAMBITION",t.HUAWEI_V2="HUAWEI_V2",t.FEISHU="FEISHU",t.JD="JD",t.DOUYIN="DOUYIN",t.TOUTIAO="TOUTIAO",t.MI="MI",t.RENREN="RENREN",t.MEITUAN="MEITUAN",t.ELEME="ELEME",t.KUJIALE="KUJIALE",t.XMLY="XMLY",t.GITEE="GITEE",t.OSCHINA="OSCHINA",t.CSDN="CSDN",t.GITHUB="GITHUB",t.GITLAB="GITLAB",t.STACK_OVERFLOW="STACK_OVERFLOW",t.CODING="CODING",t.GOOGLE="GOOGLE",t.MICROSOFT="MICROSOFT",t.FACEBOOK="FACEBOOK",t.LINKEDIN="LINKEDIN",t.TWITTER="TWITTER",t.AMAZON="AMAZON",t.SLACK="SLACK",t.LINE="LINE",t.OKTA="OKTA",t.PINTEREST="PINTEREST",t))(H||{}),P=(t=>(t.APP="APP",t.PERSONAL="PERSONAL",t))(P||{});const F=w.defineStore("Application",{state:()=>({leftDrawer:!0,rightDrawer:!1,signInPanel:"account"}),actions:{switchToMobilePanel(){this.signInPanel="mobile"},switchToScanPanel(){this.signInPanel="scan"},switchToAccountPanel(){this.signInPanel="account"}}});class d{static _instance=null;static _initialized=!1;options;constructor(e){this.options=e}static initialize(e){if(d._initialized)throw new Error("RouterUtilities has already been initialized");return d._instance=new d(e),d._initialized=!0,d._instance}static getInstance(){if(!d._instance)throw new Error("RouterUtilities not initialized. Call initialize() first.");return d._instance}setOptions(e){this.options=e}getOptions(){return this.options}static axiosConfig(){return this.getInstance().getOptions().config}static getRouterOptions(){return this.getInstance().getOptions().router}static getRouter(){return this.getRouterOptions().instance}static getRoutes(){return this.getInstance().getOptions().staticRoutes}static getSecurityKey(){return this.getInstance().getOptions().variables.securityKey}static getRedirectUri(){return this.getInstance().getOptions().variables.redirectUri}static isUseCrypto(){return this.getInstance().getOptions().variables.isUseCrypto}static isAutoRefreshToken(){return this.getInstance().getOptions().variables.isAutoRefreshToken}static getTenantId(){return this.getInstance().getOptions().variables.tenantId}}class E{static _instance=null;static _initialized=!1;options;router={};constructor(e){this.options=e,this.router=e.instance}static initialize(e){if(E._initialized)throw new Error("RouterUtilities has already been initialized");return E._instance=new E(e),E._initialized=!0,E._instance}static getInstance(){if(!E._instance)throw new Error("RouterUtilities not initialized. Call initialize() first.");return E._instance}setRouter(e){this.router=e}getRouter(){return this.router}isRouterExist(){return!a.lodash.isEmpty(this.router)}hasParameter(e){return!a.lodash.isEmpty(e.params)||!a.lodash.isEmpty(e.query)}isDetailRoute(e){return!!(e.meta&&e.meta.isDetailContent)}isValidDetailRoute(e){return this.isDetailRoute(e)&&this.hasParameter(e)}push(e){return this.router.push(e)}replace(e){return this.router.replace(e)}to(e,s=!1){s?this.push(e):this.replace(e)}open(e){const s=this.router.resolve(e);window.open(s.href,"_blank")}goBack(){this.router.go(-1)}refresh(){this.isRouterExist()?this.router.go(0):window.location.reload()}toRoot(){this.isRouterExist()&&this.to(this.options.path.root)}toHome(){this.isRouterExist()&&this.to(this.options.path.home)}toSignIn(){this.isRouterExist()?this.to(this.options.path.signIn):this.refresh()}getParent(e){const s=a.lodash.split(e,"/"),i=a.lodash.dropRight(s);return a.lodash.join(i,"/")}toPrev(e){if(e.path){const s=this.getParent(e.path);this.to({path:s})}else this.goBack()}}class y{static _instance=null;static _initialized=!1;extension;constructor(e){this.extension=e}static initialize(e){if(y._initialized)throw new Error("SignOutUtilities has already been initialized");return y._instance=new y(e),y._initialized=!0,y._instance}static getInstance(){if(!y._instance)throw new Error("SignOutUtilities not initialized. Call initialize() first.");return y._instance}signOut(e=!1){e||L().signOut(),this.extension(),console.log("Clear Framework Kernel Data"),L().$reset(),D().$reset(),E.getInstance().toSignIn()}signOutWithDialog(){a.Swal.fire({title:"要走了么?",text:"您确定要退出系统！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的",cancelButtonText:"取消"}).then(e=>{e.value&&this.signOut()})}tokenExpires(e,s,i,n=!1){a.Swal.fire({title:e,text:s,icon:i,showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"},confirmButtonText:"已阅!",willClose:()=>{this.signOut(n)}})}}class U{static instance=null;config={};constructor(e){this.config=e}static getInstance(e){return this.instance==null&&(this.instance=new U(e)),this.instance}getOAuth2TokenAddress(){return this.config.getUaa()+"/oauth2/token"}getOAuth2RevokeAddress(){return this.config.getUaa()+"/oauth2/revoke"}getOAuth2SignOutAddress(){return this.config.getUaa()+"/oauth2/sign-out"}getOAuth2DeviceAuthorizationAddress(){return this.config.getUaa()+"/oauth2/device_authorization"}getOIDCConnectRegisterAddress(){return this.config.getUaa()+"/connect/register"}createBasicHeader(e="",s=""){let i=this.config.getClientId()+":"+this.config.getClientSecret();return e&&s&&(i=e+":"+s),a.AuthorizationTokenEnum.BASIC+a.Base64.encode(i)}createClientData(e="",s="",i=""){const n={client_id:"",client_secret:""};return e&&s?(n.client_id=e,n.client_secret=s):(n.client_id=this.config.getClientId(),n.client_secret=this.config.getClientSecret()),i&&a.lodash.merge(n,{scope:i}),n}createOAuth2Data(e,s,i=!1){const n={grant_type:e};return a.lodash.isEmpty(s)||a.lodash.merge(n,s),i&&a.lodash.merge(n,{scope:"openid"}),n}signOut(e,s="",i=""){return this.config.getHttp().put(this.getOAuth2SignOutAddress(),{accessToken:e},{contentType:a.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(s,i)}})}revoke(e,s="",i=""){return this.config.getHttp().post(this.getOAuth2RevokeAddress(),{token:e},{contentType:a.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(s,i)}})}refreshTokenFlow(e,s=!1,i="",n=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(a.AuthorizationGrantTypeEnum.REFRESH_TOKEN,{refresh_token:e},s),{contentType:a.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(i,n)}})}passwordFlow(e,s,i=!1,n="",o=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(a.AuthorizationGrantTypeEnum.PASSWORD,{username:e,password:s},i),{contentType:a.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(n,o)}})}authorizationCodeFlow(e,s,i="",n=!1,o="",m=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(a.AuthorizationGrantTypeEnum.AUTHORIZATION_CODE,{code:e,state:i,redirect_uri:s},n),{contentType:a.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(o,m)}})}clientCredentialsFlow(e="",s="",i=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(a.AuthorizationGrantTypeEnum.CLIENT_CREDENTIALS,{...this.createClientData(e,s,i)}),{contentType:a.ContentTypeEnum.URL_ENCODED})}deviceCodeFlow(e,s="",i="",n=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(a.AuthorizationGrantTypeEnum.DEVICE_CODE,{device_code:e,...this.createClientData(s,i,n)}),{contentType:a.ContentTypeEnum.URL_ENCODED})}deviceAuthorizationFlow(e="",s="",i=a.BuildInScopeEnum.EMAIL){return this.config.getHttp().post(this.getOAuth2DeviceAuthorizationAddress(),this.createClientData(e,s,i),{contentType:a.ContentTypeEnum.URL_ENCODED})}socialCredentialsFlowBySms(e,s,i=!1,n="",o=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(a.AuthorizationGrantTypeEnum.SOCIAL_CREDENTIALS,{mobile:e,code:s,source:H.SMS},i),{contentType:a.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(n,o)}})}socialCredentialsFlowByJustAuth(e,s,i=!1,n="",o=""){return this.config.getHttp().post(this.getOAuth2TokenAddress(),this.createOAuth2Data(a.AuthorizationGrantTypeEnum.SOCIAL_CREDENTIALS,{...s,source:e},i),{contentType:a.ContentTypeEnum.URL_ENCODED},{headers:{Authorization:this.createBasicHeader(n,o)}})}}class S{static instance=null;config={};constructor(e){this.config=e}static getInstance(e){return this.instance==null&&(this.instance=new S(e)),this.instance}createSession(e=""){const s=this.config.getUaa()+"/open/identity/session";return this.config.getHttp().post(s,{clientId:this.config.getClientId(),clientSecret:this.config.getClientSecret(),sessionId:e})}exchange(e="",s){const i=this.config.getUaa()+"/open/identity/exchange";return this.config.getHttp().post(i,{publicKey:s,sessionId:e})}getPrompt(e){const s=this.config.getUaa()+"/open/identity/prompt";return this.config.getHttp().post(s,{username:e})}createCaptcha(e,s){const i=this.config.getUaa()+"/open/captcha";return this.config.getHttp().get(i,{identity:e,category:s})}verifyCaptcha(e,s,i){const n=this.config.getUaa()+"/open/captcha",o={identity:e,category:s,coordinate:{x:0,y:0},coordinates:[],characters:""};return s===k.WORD_CLICK?o.coordinates=i:s===k.JIGSAW?o.coordinate=i:o.characters=i,this.config.getHttp().post(n,o)}createVerificationCode(e){const s=this.config.getUpms()+"/open/identity/verification-code";return this.config.getHttp().post(s,{mobile:e},{contentType:a.ContentTypeEnum.URL_ENCODED})}getSocialList(){const e=this.config.getUpms()+"/open/identity/sources";return this.config.getHttp().get(e)}}class u{static _instance=null;static _initialized=!1;config={};constructor(e){this.config=e}static initialize(e){if(u._initialized)throw new Error("SecurityApiResources has already been initialized");return u._instance=new u(e),u._initialized=!0,u._instance}static getInstance(){if(!u._instance)throw new Error("SecurityApiResources not initialized. Call initialize() first.");return u._instance}getConfig(){return this.config}open(){return S.getInstance(this.config)}oauth2(){return U.getInstance(this.config)}}const D=w.defineStore("Crypto",{state:()=>({sessionId:"",key:"",state:""}),actions:{setSessionId(t){this.sessionId=t},setKey(t){this.key=a.SM4Utils.encrypt(t,d.getSecurityKey())},getKey(){return a.SM4Utils.decrypt(this.key,d.getSecurityKey())},encrypt(t){const e=this.getKey();return a.SM4Utils.encrypt(t,e)},decrypt(t){const e=this.getKey();return a.SM4Utils.decrypt(t,e)},exchange(t=""){return new Promise((e,s)=>{u.getInstance().open().createSession(t).then(i=>{const n=i.data;if(n){const o=n.sessionId,m=n.publicKey;this.state=n.state;const R=a.SM2Utils.createKeyPair(),l=a.SM2Utils.encrypt(R.publicKey,m);u.getInstance().open().exchange(o,l).then(p=>{const c=p.data,v=a.SM2Utils.decrypt(c,R.privateKey);this.setSessionId(o),this.setKey(v),e(v)})}}).catch(i=>{s(i)})})}},persist:{storage:sessionStorage}}),L=w.defineStore("Authentication",{state:()=>({access_token:"",expires_in:0,refresh_token:"",license:"",openid:"",idToken:"",scope:"",token_type:"",errorTimes:0,remainTimes:0,locked:!1,userId:"",username:"",employeeId:"",avatar:"",roles:[]}),getters:{isNotExpired:t=>{const e=a.moment().add(t.expires_in,"seconds").valueOf();return a.moment(e).add(1,"seconds").diff(a.moment(),"seconds")!==0},token(){return d.isAutoRefreshToken()?this.access_token:this.isNotExpired?this.access_token:""}},actions:{getBearerToken(){return a.AuthorizationTokenEnum.BEARER+this.token},getAuthorizationHeader(){return{Authorization:this.getBearerToken(),"X-Herodotus-Open-Id":this.userId}},saveAccessToken(t){if(this.access_token=t.access_token,this.expires_in=t.expires_in,this.refresh_token=t.refresh_token?t.refresh_token:"",this.license=t.refresh_token?t.refresh_token:"",this.scope=t.scope,this.token_type=t.token_type,t.id_token){this.idToken=t.id_token;const e=B.jwtDecode(this.idToken);this.userId=e.openid,this.username=e.sub,this.avatar=e.avatar,this.employeeId=e.employeeId,this.roles=e.roles}else if(t.openid){const e=D();this.openid=t.openid;const s=e.decrypt(this.openid),i=JSON.parse(s);this.userId=i.userId,this.username=i.username,this.roles=i.roles,this.avatar=i.avatar,this.employeeId=i.employeeId}else console.warn("There is no id token or openid in the data.")},setUserErrorStatus(t){this.remainTimes=t.remainTimes,this.errorTimes=t.errorTimes,this.locked=t.locked},isAlertMessage(t){return t.code&&[40106,40111].includes(t.code)},setErrorPrompt(t,e){this.isAlertMessage(t)&&u.getInstance().open().getPrompt(e).then(s=>{this.setUserErrorStatus(s.data)})},signIn(t,e){const s=D();return d.isUseCrypto()&&(t=s.encrypt(t),e=s.encrypt(e)),new Promise((i,n)=>{u.getInstance().oauth2().passwordFlow(t,e,d.isUseCrypto()).then(o=>{if(o){const m=o;this.saveAccessToken(m)}this.access_token?i(!0):i(!1)}).catch(o=>{this.setErrorPrompt(o,t),n(o)})})},refreshToken(){return new Promise((t,e)=>{u.getInstance().oauth2().refreshTokenFlow(this.refresh_token,d.isUseCrypto()).then(s=>{if(s){const i=s;this.saveAccessToken(i)}this.access_token?t(!0):t(!1)}).catch(s=>{e(s)})})},signOut(){this.access_token&&u.getInstance().oauth2().signOut(this.access_token).then(()=>{console.log("Server side sign out successfully.")}).catch(t=>{console.log("Server side sign out has error.",t)})},authorizationCode(t,e=""){return new Promise((s,i)=>{u.getInstance().oauth2().authorizationCodeFlow(t,d.getRedirectUri(),e,d.isUseCrypto()).then(n=>{if(n){const o=n;this.saveAccessToken(o)}this.access_token?s(!0):s(!1)}).catch(n=>{i(n)})})},smsSignIn(t,e){const s=D();return d.isUseCrypto()&&(t=s.encrypt(t),e=s.encrypt(e)),new Promise((i,n)=>{u.getInstance().oauth2().socialCredentialsFlowBySms(t,e,d.isUseCrypto()).then(o=>{if(o){const m=o;this.saveAccessToken(m)}this.access_token?i(!0):i(!1)}).catch(o=>{this.setErrorPrompt(o,t),n(o)})})},socialSignIn(t,e){return new Promise((s,i)=>{u.getInstance().oauth2().socialCredentialsFlowByJustAuth(t,e,d.isUseCrypto()).then(n=>{if(n){const o=n;this.saveAccessToken(o)}this.access_token?s(!0):s(!1)}).catch(n=>{n.code&&[40106,40111].includes(n.code)&&i(n)})})}},persist:!0}),K=()=>{const t=L(),e=D(),s=t.access_token,i=e.sessionId,n={};s&&(n.Authorization=a.AuthorizationTokenEnum.BEARER+s),i&&(n["X-Herodotus-Session-Id"]=i);const o=d.getTenantId();return o&&(n["X-Herodotus-Tenant-Id"]=o),n},b=w.defineStore("Router",{state:()=>({appMenus:[],personalMenus:[],cachedRoutes:[],details:new Map(new Map),pushParams:{}}),getters:{isDynamicRouteAdded(){return!a.lodash.isEmpty(this.appMenus)||!a.lodash.isEmpty(this.personalMenus)}},actions:{getDetailComponent(t){return this.details.get(t)},getRoutePushParam(t){return this.pushParams[t]},addMenus(t,e){a.lodash.isEmpty(t)||(this.appMenus=t),a.lodash.isEmpty(e)||(this.personalMenus=e)},addCachedRoute(t){if(!t.meta?.isNotKeepAlive){const e=t.name;this.cachedRoutes.includes(e)||this.cachedRoutes.push(e)}},addDetailRoute(t){const e=t.name;e&&this.details.set(e,t.component)},hasParameter(t){const e=t.name;return!!(e&&a.lodash.has(this.pushParams,e))},isDetailRoute(t){return!!(t.meta&&t.meta.isDetailContent)},isValidDetailRoute(t){return this.isDetailRoute(t)&&this.hasParameter(t)},addRoutePushParam(t,e={}){t&&(this.pushParams[t]=e)},removeRoutePushParam(t){t&&delete this.pushParams[t]}}}),z=w.defineStore("GlobalSettings",{state:()=>({theme:{mode:C.SYSTEM,isMixed:!0,primary:"#1867c0"},layout:N.DEFAULT,effect:{isUniqueOpened:!1},display:{isTabsView:!0,isActivateLeftTab:!0,showBreadcrumbs:!0,showBreadcrumbsIcon:!0,table:{dense:!1}}}),getters:{isDark:t=>t.theme.mode===C.DARK,isLight:t=>t.theme.mode===C.LIGHT,isSystem:t=>t.theme.mode===C.SYSTEM,isDefaultLayout:t=>t.layout===N.DEFAULT,isClassicLayout:t=>t.layout===N.CLASSIC},persist:!0}),x=w.defineStore("TabsView",{state:()=>({tabs:[],activatedTab:{},activatedTabName:""}),getters:{isNotLastTab:t=>e=>t.tabs.length-1!==e,getLastTabIndex:t=>t.tabs.length-1,getTabIndex:t=>e=>a.lodash.findIndex(t.tabs,s=>s.name===e.name),getActivatedTabIndex(){return this.getTabIndex(this.activatedTab)},isLastTabActivated(){return this.getActivatedTabIndex===this.getLastTabIndex},isFirstTabActivated(){return this.getActivatedTabIndex===0},disableCloseCurrentTab(){return this.isLastTabActivated||this.isFirstTabActivated},disableCloseLeftTabs(){return this.isFirstTabActivated},disableCloseRightTabs(){return this.isLastTabActivated},disableRefreshCurrentTab(){return!!(this.activatedTab.meta&&this.activatedTab.meta.isDetailContent)}},actions:{convertRouteToTab(t){return{name:t.name,path:t.path,meta:t.meta}},setActivatedTab(t){_.nextTick(()=>{this.activatedTab=t,this.activatedTabName=t.name})},isNotExistInStaticRoute(t){return a.lodash.findIndex(d.getRoutes(),e=>e.path===t.path)===-1},isTabNotOpened(t){return this.getTabIndex(t)===-1},openTab(t,e=!1){this.isNotExistInStaticRoute(t)&&(this.isTabNotOpened(t)&&(e?this.isLastTabActivated?this.tabs.splice(this.getActivatedTabIndex,0,t):this.tabs.splice(this.getActivatedTabIndex+1,0,t):this.tabs.push(t)),this.setActivatedTab(t))},closeTab(t){a.lodash.remove(this.tabs,e=>e.name===t.name)},smartTab(t){const e=b(),s=e.isDetailRoute(t),i=this.convertRouteToTab(t);s?e.hasParameter(t)?this.openTab(i,s):(this.closeTab(i),E.getInstance().goBack()):this.openTab(i,s)},deleteTab(t){const e=this.convertRouteToTab(t);this.closeTab(e)},closeCurrentTab(){this.closeTab(this.activatedTab)},closeOtherTabs(){a.lodash.remove(this.tabs,t=>t.name!==this.activatedTab.name)},closeLeftTabs(){const t=this.getActivatedTabIndex;a.lodash.remove(this.tabs,(e,s)=>s<t)},closeRightTabs(){const t=this.getActivatedTabIndex;a.lodash.remove(this.tabs,(e,s)=>s>t)}},persist:!0});function G(){const t=M.useRoute(),e=b(),s=x();return{onFinish:()=>{const n=t.name;e.removeRoutePushParam(n),s.deleteTab(t),E.getInstance().goBack()}}}function W(){b();const t=L(),e=l=>l.meta?.title,s=l=>l.meta?.icon,i=l=>l.meta?.isHideAllChild,n=l=>l.children,o=l=>!!n(l);return{hasPermission:l=>{const p=t.roles,c=l.meta?.roles;if(a.lodash.isEmpty(c))return!0;if(a.lodash.isEmpty(p))return!1;const v=a.lodash.intersection(p,c);return!a.lodash.isEmpty(v)},getItemTitle:e,getItemIcon:s,getItemChildren:n,isDisplayAsItem:l=>o(l)?!!i(l):!0}}function Y(t,e,s,i){const n=r=>r.meta?.isDetailContent,o=r=>r.meta?.scenario,m=(r,g)=>{const h={};return h.path=r.name,h.component=g[s(r.componentPath)],r.componentName&&(h.name=r.componentName),r.redirect&&(h.redirect=r.redirect),h.meta={scenario:r.scenario,icon:r.meta.icon,title:r.meta.title,...r.meta.sort&&{sort:r.meta.sort},...r.meta.isHaveChild&&{isHaveChild:r.meta.isHaveChild},...r.meta.isNotKeepAlive&&{isNotKeepAlive:r.meta.isNotKeepAlive},...r.meta.isHideAllChild&&{isHideAllChild:r.meta.isHideAllChild},...r.meta.isDetailContent&&{isDetailContent:r.meta.isDetailContent},...r.meta.isIgnoreAuth&&{isIgnoreAuth:r.meta.isIgnoreAuth}},h},R=(r,g)=>{const h=b();return r.map(T=>{const f=m(T,g);return n(f)&&h.addDetailRoute(f),T.children&&T.children.length>0&&(f.children=R(T.children,g)),f})},l=()=>{const r=[],g=t;return Object.keys(g).forEach(h=>{const f=g[h].default||{},A=Array.isArray(f)?[...f]:[f];r.push(...A)}),r},p=(r,g)=>{const h=r.meta?.sort||0,T=g.meta?.sort||0;return h-T},c=(r,g)=>{const h=b();if(console.log("[Herodotus] |- Begin add dynamic routes"),a.lodash.isEmpty(g))console.warn("[Herodotus] |- Dynamic routes is empty, skip!");else{const T=[],f=[];g.forEach(A=>{r.addRoute(A),o(A)===P.APP?T.push(A):f.push(A)}),h.addMenus(T,f),console.log("[Herodotus] |- Dynamic routes add success!")}};return{initBackEndRoutes:async(r,g)=>{const T=(await i(g)).data.menus,A=R(T,e);console.log("---routes---",A),c(r,A)},initFrontEndRoutes:async r=>{const h=l().sort(p);console.log(h),c(r,h)}}}function V(){let t;const e=z(),s=_.shallowRef(C.DARK),i=typeof window<"u",n=()=>{if(i)return window.matchMedia("(prefers-color-scheme: dark)")},o=()=>{s.value=t.matches?C.DARK:C.LIGHT},m=p=>{if(!p||p.nodeType!==Node.ELEMENT_NODE)return!1;const c=window.getComputedStyle(p);return c.overflowY==="scroll"||c.overflowY==="auto"&&p.scrollHeight>p.clientHeight},R=()=>{const p=performance.now();if(performance.now()-p>10)return;const c=document.querySelector("[data-v-app]");c.querySelectorAll("*").forEach(I=>{m(I)&&(I.dataset.scrollX=String(I.scrollLeft),I.dataset.scrollY=String(I.scrollTop))});const O=c.cloneNode(!0);O.classList.add("app-copy");const r=c.getBoundingClientRect();O.style.top=r.top+"px",O.style.left=r.left+"px",O.style.width=r.width+"px",O.style.height=r.height+"px";const h=document.activeElement.getBoundingClientRect(),T=h.left+h.width/2+window.scrollX,f=h.top+h.height/2+window.scrollY;c.style.setProperty("--clip-pos",`${T}px ${f}px`),c.style.removeProperty("--clip-size"),_.nextTick(()=>{c.classList.add("app-transition"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{c.style.setProperty("--clip-size",Math.hypot(window.innerWidth,window.innerHeight)+"px")})})}),document.body.append(O),O.querySelectorAll("[data-scroll-x], [data-scroll-y]").forEach(I=>{I.scrollLeft=Number(I.dataset.scrollX),I.scrollTop=Number(I.dataset.scrollY)});function A(I){I.target===I.currentTarget&&(O.remove(),c.removeEventListener("transitionend",A),c.removeEventListener("transitioncancel",A),c.classList.remove("app-transition"),c.style.removeProperty("--clip-size"),c.style.removeProperty("--clip-pos"))}c.addEventListener("transitionend",A),c.addEventListener("transitioncancel",A)};_.watch(()=>e.theme.mode,p=>{p===C.SYSTEM?(t=n(),t.addEventListener("change",o),o()):t&&t.removeEventListener("change",o)},{immediate:!0});const l=_.computed(()=>e.isSystem?s.value:e.theme.mode);return _.watch(l,R),{theme:l}}const q=t=>{d.initialize(t),E.initialize(t.router),u.initialize(t.config),y.initialize(t.signOutExtension)};exports.CaptchaCategoryEnum=k;exports.LayoutModeEnum=N;exports.MenuScenario=P;exports.OptionsUtilities=d;exports.RouterUtilities=E;exports.SecurityApiResources=u;exports.SignOutUtilities=y;exports.SocialSourceEnum=H;exports.ThemeModeEnum=C;exports.getSystemHeaders=K;exports.initializer=q;exports.useApplicationStore=F;exports.useAuthenticationStore=L;exports.useCryptoStore=D;exports.useEditFinish=G;exports.useRouterStore=b;exports.useSettingsStore=z;exports.useSystemMenu=W;exports.useSystemRoute=Y;exports.useSystemTheme=V;exports.useTabsViewStore=x;
