!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("axios"),require("qs"),require("lodash-es"),require("generate-avatar"),require("sm-crypto"),require("js-base64"),require("sweetalert2"),require("moment"),require("moment/dist/locale/zh-cn")):"function"==typeof define&&define.amd?define(["exports","axios","qs","lodash-es","generate-avatar","sm-crypto","js-base64","sweetalert2","moment","moment/dist/locale/zh-cn"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@herodotus/core"]={},e.Axios,e.Qs,e.LodashEs,e.GenerateAvatar,e.SmCrypto,e.JsBase64,e.Sweetalert2,e.Moment)}(this,function(e,t,s,r,n,i,o,a,c){"use strict";var d=Object.defineProperty,u=(e,t,s)=>((e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s)(e,"symbol"!=typeof t?t+"":t,s);function h(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const s in e)if("default"!==s){const r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:()=>e[s]})}return t.default=e,Object.freeze(t)}const g=h(r);var p=(e=>(e[e.URL_ENCODED=0]="URL_ENCODED",e[e.MULTI_PART=1]="MULTI_PART",e[e.TEXT=2]="TEXT",e[e.JSON=3]="JSON",e))(p||{}),l=(e=>(e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e))(l||{}),m=(e=>(e[e.FORBIDDEN=0]="FORBIDDEN",e[e.ENABLE=1]="ENABLE",e[e.LOCKING=2]="LOCKING",e[e.EXPIRED=3]="EXPIRED",e))(m||{});let f=new Map;const y=e=>[e.method,e.url].join("&");class AxiosCanceler{addPending(e){this.removePending(e);const s=y(e);e.cancelToken=e.cancelToken||new t.CancelToken(e=>{f.has(s)||f.set(s,e)})}removeAllPending(){f.forEach(e=>{e&&r.isFunction(e)&&e()}),f.clear()}removePending(e){const t=y(e);if(f.has(t)){const e=f.get(t);e&&e(t),f.delete(t)}}reset(){f=new Map}}const A=class _AvatarUtilities{constructor(){}static getInstance(){return this.instance}generate(e){return`data:image/svg+xml;utf8,${n.generateFromString(e)}`}};u(A,"instance",new A);const T=A.getInstance(),P=class _SM2Utilities{constructor(){u(this,"cipherMode",1)}static getInstance(){return this.instance}createKeyPair(){return i.sm2.generateKeyPairHex()}encrypt(e,t){return"04"+i.sm2.doEncrypt(e,t,this.cipherMode)}decrypt(e,t){let s=e.substring(2).toLocaleLowerCase();return i.sm2.doDecrypt(s,t,this.cipherMode)}};u(P,"instance",new P);let C=P;const x=class _SM4Utilities{constructor(){}static getInstance(){return this.instance}encrypt(e,t){return i.sm4.encrypt(e,t)}decrypt(e,t){return i.sm4.decrypt(e,t)}};u(x,"instance",new x);let b=x;const O=C.getInstance(),E=b.getInstance(),I=a.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,timerProgressBar:!1,didOpen:e=>{e.addEventListener("mouseenter",a.stopTimer),e.addEventListener("mouseleave",a.resumeTimer)}}),q=class _Notify{constructor(){}static getInstance(){return this.instance}information(e,t,s){return a.fire({title:e,text:t,position:"top",icon:s,timer:5e3,showConfirmButton:!1,showClass:{popup:"animate__animated animate__fadeIn"},hideClass:{popup:"animate__animated animate__fadeOut"}})}info(e,t=""){return this.information(e,t,"info")}error(e,t=""){return this.information(e,t,"error")}warning(e,t=""){return this.information(e,t,"warning")}success(e,t=""){return this.information(e,t,"success")}question(e,t=""){return this.information(e,t,"question")}};u(q,"instance",new q);const S=q.getInstance(),w=class _Toast{constructor(){}static getInstance(){return this.instance}information(e,t){return I.fire({icon:t,title:e})}info(e){return this.information(e,"info")}error(e){return this.information(e,"error")}warning(e){return this.information(e,"warning")}success(e){return this.information(e,"success")}question(e){return this.information(e,"question")}};u(w,"instance",new w);const v=w.getInstance();c.locale("zh-cn");class Service{constructor(e){u(this,"config"),this.config=e}getConfig(){return this.config}getParamPath(e,t){return e+"/"+t}getIdPath(e){return this.getParamPath(this.getBaseAddress(),e)}}e.lodash=g,Object.defineProperty(e,"Base64",{enumerable:!0,get:()=>o.Base64}),e.Swal=a,e.moment=c,e.AvatarUtils=T,e.Axios=class Axios{constructor(e,t,s){u(this,"axiosInstance"),u(this,"axiosConfig"),u(this,"axiosTransform"),u(this,"defaultRequestOptions"),this.axiosConfig=e,this.axiosTransform=t,this.defaultRequestOptions=s,this.axiosInstance=this.createAxiosInstance(e),this.setupInterceptors()}createAxiosInstance(e){return t.create(e)}getAxiosConfig(){return this.axiosConfig}getAxiosTransform(){return this.axiosTransform}getAxiosInstance(){return this.axiosInstance}getDefaultRequestOptions(){return this.defaultRequestOptions}getPolicy(e){switch(e){case p.URL_ENCODED:return{headers:{"Content-Type":"application/x-www-form-urlencoded"},dataConvert:e=>s.stringify(e,{arrayFormat:"brackets"})};case p.MULTI_PART:return{headers:{"Content-Type":"multipart/form-data"},dataConvert:e=>e};default:return{headers:{"Content-Type":"application/json"},dataConvert:e=>JSON.stringify(e)}}}setupInterceptors(){const e=this.getAxiosTransform();if(!e)return;const{requestInterceptors:t,requestInterceptorsCatch:s,responseInterceptors:r,responseInterceptorsCatch:n}=e,i=new AxiosCanceler;this.getAxiosInstance().interceptors.request.use(e=>{const{prohibitRepeatRequests:s}=this.getDefaultRequestOptions();return s&&i.addPending(e),t(e)},e=>s(this.getAxiosInstance(),e)),this.getAxiosInstance().interceptors.response.use(e=>(e&&i.removePending(e.config),r(e)),e=>n(this.getAxiosInstance(),e))}mergeRequestOptions(e){const t=this.getDefaultRequestOptions();return r.isEmpty(e)?t:Object.assign({},t,e)}mergeRequestConfigs(e){const t=this.getAxiosConfig(),s={serialize:e=>Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")},r=Object.assign({paramsSerializer:s},t);return e?Object.assign({},r,e):r}setupPolicy(e,t,s){const{beforeRequestHook:n}=this.getAxiosTransform(),i=this.mergeRequestOptions(t);let o=this.mergeRequestConfigs(s);n&&r.isFunction(n)&&(o=n(o,i));const a=i.contentType,c=this.getPolicy(a);return o.headers?o.headers=Object.assign(o.headers,c.headers):o.headers=c.headers,o.url=e,r.isEmpty(o.data)||(o.data=c.dataConvert(o.data)),{config:o,options:i,dataConvert:c.dataConvert}}get(e,t={},s={contentType:p.JSON}){let r=this.setupPolicy(e,s,{params:t,method:l.GET});return this.request(r.config,r.options)}post(e,t,s={contentType:p.JSON},r){let n=this.setupPolicy(e,s,{...r,data:t,method:l.POST});return this.request(n.config,n.options)}postWithParams(e,t={},s={},r={contentType:p.JSON},n){let i=this.setupPolicy(e,r,{...n,params:t,data:s,method:l.POST});return this.request(i.config,i.options)}put(e,t,s={contentType:p.JSON},r){let n=this.setupPolicy(e,s,{...r,data:t,method:l.PUT});return this.request(n.config,n.options)}putWithParams(e,t={},s={},r={contentType:p.JSON},n){let i=this.setupPolicy(e,r,{...n,params:t,data:s,method:l.PUT});return this.request(i.config,i.options)}delete(e,t={},s={contentType:p.JSON}){let r=this.setupPolicy(e,s,{data:t,method:l.DELETE});return this.request(r.config,r.options)}deleteWithParams(e,t={},s={},r={contentType:p.JSON}){let n=this.setupPolicy(e,r,{params:t,data:s,method:l.DELETE});return this.request(n.config,n.options)}request(e,t){return new Promise((s,n)=>{const{requestCatchHook:i,transformRequestHook:o}=this.getAxiosTransform();this.getAxiosInstance().request(e).then(e=>{if(o&&r.isFunction(o)){const r=o(e,t);s(r)}else s(e)}).catch(e=>{i&&r.isFunction(i)?n(i(e,t)):n(e)})})}},e.BaseService=class BaseService extends Service{getConditionAddress(){return this.getBaseAddress()+"/condition"}getListAddress(){return this.getBaseAddress()+"/list"}getTreeAddress(){return this.getBaseAddress()+"/tree"}fetch(e={}){return this.getConfig().getHttp().get(this.getBaseAddress(),e)}fetchByPage(e,t={}){if(r.isEmpty(t))return this.getConfig().getHttp().get(this.getBaseAddress(),e);{const s=Object.assign(e,t);return this.getConfig().getHttp().get(this.getConditionAddress(),s)}}fetchAll(e={}){return this.getConfig().getHttp().get(this.getListAddress(),e)}fetchTree(e={}){return this.getConfig().getHttp().get(this.getTreeAddress(),e)}saveOrUpdate(e){return this.getConfig().getHttp().post(this.getBaseAddress(),e)}delete(e){return this.getConfig().getHttp().delete(this.getIdPath(e))}assign(e){return this.getConfig().getHttp().put(this.getBaseAddress(),e,{contentType:p.URL_ENCODED})}},e.ContentTypeEnum=p,e.HttpConfig=class HttpConfig{constructor(e,t,s,r,n=!1,i="/api"){u(this,"http",{}),u(this,"project",""),u(this,"clientId",""),u(this,"clientSecret",""),u(this,"oidc",!1),u(this,"uaaAddress",""),u(this,"upmsAddress",""),u(this,"msgAddress",""),u(this,"ossAddress",""),u(this,"bpmnAddress",""),u(this,"cmdbAddress",""),u(this,"proxy",""),this.project=e,this.clientId=t,this.clientSecret=s,this.http=r,this.oidc=n,this.proxy=i,this.switch(e)}switch(e){switch(e){case"dante":this.uaaAddress="/dante-cloud-uaa",this.upmsAddress="/dante-cloud-upms",this.msgAddress="/dante-cloud-message",this.ossAddress="/dante-cloud-oss-ability",this.bpmnAddress="/dante-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/dante-cloud-cmdb-ability";break;case"herodotus":this.uaaAddress="/herodotus-cloud-uaa",this.upmsAddress="/herodotus-cloud-upms",this.msgAddress="/herodotus-cloud-message",this.ossAddress="/herodotus-cloud-oss-ability",this.bpmnAddress="/herodotus-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/herodotus-cloud-cmdb-ability";break;default:this.uaaAddress="",this.upmsAddress="",this.msgAddress="",this.ossAddress="",this.bpmnAddress="/engine-rest",this.cmdbAddress=""}}getProject(){return this.project}getClientSecret(){return this.clientSecret}getClientId(){return this.clientId}isOidc(){return this.oidc}getProxy(){return this.proxy}getHttp(){return this.http}processProxy(e,t=!0){return t?this.proxy+e:e}getUaa(e=!0){return this.processProxy(this.uaaAddress,e)}getUpms(e=!0){return this.processProxy(this.upmsAddress,e)}getMsg(e=!0){return this.processProxy(this.msgAddress,e)}getOss(e=!0){return this.processProxy(this.ossAddress,e)}getBpmn(e=!0,t=!1){let s=this.processProxy(this.bpmnAddress,e);return t?g.replace(s,"engine-rest","camunda-extended"):s}getCmdb(e=!0){return this.processProxy(this.cmdbAddress,e)}},e.HttpMethodEnum=l,e.SM2Utils=O,e.SM4Utils=E,e.Service=Service,e.StatusEnum=m,e.notify=S,e.parseResponseStatus=(e,t)=>{const s=e.data,r={};return r.status=e.status,r.code=e.data&&e.data.code?e.data.code:0,r.detail=s.error&&s.error.detail?s.error.detail:"",s.message?r.message=s.message:s.error&&s.error.message?r.message=s.error.message:t&&(r.message=t),r},e.standardDeleteNotify=(e,t)=>{a.fire({title:"确定删除?",text:"您将无法恢复此操作！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的, 删除!",cancelButtonText:"取消"}).then(s=>{s.value?e():t&&t()})},e.toast=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
