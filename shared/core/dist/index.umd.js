!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("axios"),require("qs"),require("@vueuse/integrations/useAxios"),require("ts-md5"),require("lodash-es"),require("moment"),require("moment/dist/locale/zh-cn"),require("generate-avatar"),require("sm-crypto-v2"),require("js-base64"),require("sweetalert2"),require("crypto-js")):"function"==typeof define&&define.amd?define(["exports","axios","qs","@vueuse/integrations/useAxios","ts-md5","lodash-es","moment","moment/dist/locale/zh-cn","generate-avatar","sm-crypto-v2","js-base64","sweetalert2","crypto-js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@herodotus-cloud/core"]={},e.Axios,e.Qs,e.VueuseIntegrationsUseAxios,e.TsMd5,e.LodashEs,e.Moment,e.MomentDistLocaleZhcn,e.GenerateAvatar,e.SmCryptoV2,e.JsBase64,e.Sweetalert2,e.CryptoJs)}(this,function(e,t,s,r,n,i,o,a,c,d,u,h,p){"use strict";var g=(e=>(e[e.URL_ENCODED=0]="URL_ENCODED",e[e.MULTI_PART=1]="MULTI_PART",e[e.TEXT=2]="TEXT",e[e.JSON=3]="JSON",e))(g||{}),l=(e=>(e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e))(l||{}),m=(e=>(e[e.FORBIDDEN=0]="FORBIDDEN",e[e.ENABLE=1]="ENABLE",e[e.LOCKING=2]="LOCKING",e[e.EXPIRED=3]="EXPIRED",e))(m||{}),A=(e=>(e.BASIC="Basic ",e.BEARER="Bearer ",e))(A||{}),E=(e=>(e.AUTHORIZATION_CODE="authorization_code",e.REFRESH_TOKEN="refresh_token",e.CLIENT_CREDENTIALS="client_credentials",e.PASSWORD="password",e.SOCIAL_CREDENTIALS="social_credentials",e.WEBAUTHN_CREDENTIALS="webauthn_credentials",e.DEVICE_CODE="urn:ietf:params:oauth:grant-type:device_code",e.JWT_BEARER="urn:ietf:params:oauth:grant-type:jwt-bearer",e.TOKEN_EXCHANGE="urn:ietf:params:oauth:grant-type:token-exchange",e))(E||{}),f=(e=>(e.CLIENT_SECRET_BASIC="client_secret_basic",e.CLIENT_SECRET_POST="client_secret_post",e.CLIENT_SECRET_JWT="client_secret_jwt",e.PRIVATE_KEY_JWT="private_key_jwt",e.NONE="none",e.TLS_CLIENT_AUTH="tls_client_auth",e.SELF_SIGNED_TLS_CLIENT_AUTH="self_signed_tls_client_auth",e))(f||{}),T=(e=>(e.OPENID="openid",e.EMAIL="email",e.PROFILE="profile",e.PHONE="phone",e.ADDRESS="address",e.ROLES="roles",e.CLIENT_CREATE="client.create",e.CLIENT_READ="client.read",e))(T||{}),y=(e=>(e.CREATE="create",e.EDIT="edit",e.AUTHORIZE="authorize",e.INFO="info",e.ALLOCATABLE="allocatable",e.SETUP="setup",e.INVOKE="invoke",e))(y||{});let I=new Map;const C=e=>{if(!i.isEmpty(e.params)){const t=n.Md5.hashStr(e.params);return[e.method,e.url,t].join("&")}return[e.method,e.url].join("&")};class AxiosCanceler{addPending(e){this.removePending(e);const s=C(e);e.cancelToken=e.cancelToken||new t.CancelToken(e=>{I.has(s)||I.set(s,e)})}removeAllPending(){I.forEach(e=>{e&&i.isFunction(e)&&e()}),I.clear()}removePending(e){const t=C(e);if(I.has(t)){const e=I.get(t);e&&e(t),I.delete(t)}}reset(){I=new Map}}class Service{config;constructor(e){this.config=e}getConfig(){return this.config}getParamPath(e,t){return e+"/"+t}getIdPath(e){return this.getParamPath(this.getBaseAddress(),e)}}o.locale("zh-cn");class AvatarUtilities{static instance=new AvatarUtilities;constructor(){}static getInstance(){return this.instance}generate(e){return`data:image/svg+xml;utf8,${c.generateFromString(e)}`}}const S=AvatarUtilities.getInstance();class SM2Utilities{static instance=new SM2Utilities;cipherMode=1;constructor(){}static getInstance(){return this.instance}createKeyPair(){return d.sm2.generateKeyPairHex()}encrypt(e,t){return"04"+d.sm2.doEncrypt(e,t,this.cipherMode)}decrypt(e,t){let s=e.substring(2).toLocaleLowerCase();return d.sm2.doDecrypt(s,t,this.cipherMode,{output:"string"})}}class SM4Utilities{static instance=new SM4Utilities;constructor(){}static getInstance(){return this.instance}encrypt(e,t){return d.sm4.encrypt(e,t,{output:"string"})}decrypt(e,t){return d.sm4.decrypt(e,t,{output:"string"})}}const x=SM2Utilities.getInstance(),P=SM4Utilities.getInstance(),O=h.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,timerProgressBar:!1,didOpen:e=>{e.addEventListener("mouseenter",h.stopTimer),e.addEventListener("mouseleave",h.resumeTimer)}});class Notify{static instance=new Notify;constructor(){}static getInstance(){return this.instance}information(e,t,s){return h.fire({title:e,text:t,position:"top",icon:s,timer:5e3,showConfirmButton:!1,showClass:{popup:"animate__animated animate__fadeIn"},hideClass:{popup:"animate__animated animate__fadeOut"}})}info(e,t=""){return this.information(e,t,"info")}error(e,t=""){return this.information(e,t,"error")}warning(e,t=""){return this.information(e,t,"warning")}success(e,t=""){return this.information(e,t,"success")}question(e,t=""){return this.information(e,t,"question")}}const R=Notify.getInstance();class Toast{static instance=new Toast;constructor(){}static getInstance(){return this.instance}information(e,t){return O.fire({icon:t,title:e})}info(e){return this.information(e,"info")}error(e){return this.information(e,"error")}warning(e){return this.information(e,"warning")}success(e){return this.information(e,"success")}question(e){return this.information(e,"question")}}const _=Toast.getInstance();class PkceUtilities{static instance=new PkceUtilities;constructor(){}static getInstance(){return this.instance}toBytesInt32(e){const t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e,!1),t}getRandomValues(e){const t=p.lib.WordArray.random(e),s=[];return t.words.forEach(e=>{const t=this.toBytesInt32(e),r=new Uint8Array(t);for(let n=0;n<4;n++){let e=r[n];void 0!==e&&s.push(e)}}),s}random(e){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let s="";const r=this.getRandomValues(e);for(let n=0;n<e;n++){let e=r[n];if(void 0!==e){s+=t[e%66]}}return s}generateVerifier(e){return this.random(e)}generateChallenge(e){return p.SHA256(e).toString(p.enc.Base64url)}generateCodePair(e=43){if(e<43||e>128)throw`Expected a length between 43 and 128. Received ${e}.`;const t=this.generateVerifier(e);return{codeVerifier:t,codeChallenge:this.generateChallenge(t)}}verifyChallenge(e,t){return this.generateChallenge(e)===t}}const N=PkceUtilities.getInstance();e.moment=o,Object.defineProperty(e,"Base64",{enumerable:!0,get:()=>u.Base64}),e.Swal=h,e.AbstractService=class AbstractService extends Service{getConditionAddress(){return this.getBaseAddress()+"/condition"}getListAddress(){return this.getBaseAddress()+"/list"}getTreeAddress(){return this.getBaseAddress()+"/tree"}fetch(e={}){return this.getConfig().getHttp().get(this.getBaseAddress(),e)}fetchByPage(e,t={}){if(i.isEmpty(t))return this.getConfig().getHttp().get(this.getBaseAddress(),e);{const s=Object.assign(e,t);return this.getConfig().getHttp().get(this.getConditionAddress(),s)}}fetchAll(e={}){return this.getConfig().getHttp().get(this.getListAddress(),e)}fetchTree(e={}){return this.getConfig().getHttp().get(this.getTreeAddress(),e)}saveOrUpdate(e){return this.getConfig().getHttp().post(this.getBaseAddress(),e)}delete(e){return this.getConfig().getHttp().delete(this.getIdPath(e))}assign(e){return this.getConfig().getHttp().put(this.getBaseAddress(),e,{contentType:g.URL_ENCODED})}},e.AuthorizationGrantTypeEnum=E,e.AuthorizationTokenEnum=A,e.AvatarUtils=S,e.Axios=class Axios{axiosInstance;defaultAxiosRequestConfig;defaultRequestOptions;axiosInstanceHooks;constructor(e,t,s){this.defaultAxiosRequestConfig=e,this.defaultRequestOptions=s,this.axiosInstanceHooks=t,this.axiosInstance=this.createAxiosInstance(e),this.setupInterceptors()}createAxiosInstance(e){return t.create(e)}getDefaultAxiosRequestConfig(){return this.defaultAxiosRequestConfig}getDefaultRequestOptions(){return this.defaultRequestOptions}getAxiosInstanceHooks(){return this.axiosInstanceHooks}getAxiosInstance(){return this.axiosInstance}createHttpHeaderPolicy(e){switch(e){case g.URL_ENCODED:return{headers:{"Content-Type":"application/x-www-form-urlencoded"},dataConvert:e=>s.stringify(e,{arrayFormat:"brackets"})};case g.MULTI_PART:return{headers:{"Content-Type":"multipart/form-data"},dataConvert:e=>e};default:return{headers:{"Content-Type":"application/json"},dataConvert:e=>JSON.stringify(e)}}}setupInterceptors(){const e=this.getAxiosInstanceHooks();if(!e)return;const{requestInterceptors:t,requestInterceptorsError:s,responseInterceptors:r,responseInterceptorsError:n}=e,i=new AxiosCanceler;this.getAxiosInstance().interceptors.request.use(e=>{const{prohibitRepeatRequests:s}=this.getDefaultRequestOptions();return s&&i.addPending(e),t(e)},e=>s(this.getAxiosInstance(),e)),this.getAxiosInstance().interceptors.response.use(e=>(e&&i.removePending(e.config),r(e)),e=>n(this.getAxiosInstance(),e))}mergeHttpRequestOptions(e){const t=this.getDefaultRequestOptions();return i.isEmpty(e)?t:i.merge({},t,e)}mergeAxiosRequestConfigs(e){const t=this.getDefaultAxiosRequestConfig(),r={serialize:e=>s.stringify(e,{arrayFormat:"brackets"})},n=i.merge({},t,{paramsSerializer:r});return i.isEmpty(e)?n:i.merge({},n,e)}setupRequestStrategy(e,t,s){const{onRequestHook:r}=this.getAxiosInstanceHooks(),n=this.mergeHttpRequestOptions(s);let o=this.mergeAxiosRequestConfigs(t);r&&i.isFunction(r)&&(o=r(o,n));const a=this.createHttpHeaderPolicy(n.contentType);return o.headers?o.headers=i.merge(o.headers,a.headers):o.headers=a.headers,o.url=e,i.isEmpty(o.data)||(o.data=a.dataConvert(o.data)),{config:o,options:n}}request(e,t){return new Promise((s,r)=>{const{onResponseErrorHook:n,onResponseSuccessHook:o}=this.getAxiosInstanceHooks();this.getAxiosInstance().request(e).then(e=>{if(o&&i.isFunction(o)){const r=o(e,t);s(r)}else s(e)}).catch(e=>{if(n&&i.isFunction(n)){const s=n(e,t);r(s)}else r(e)})})}process(e,t,s={}){let r=this.setupRequestStrategy(e,t,s);return this.request(r.config,r.options)}get(e,t={},s={contentType:g.JSON}){return this.process(e,{params:t,method:l.GET},s)}post(e,t,s={contentType:g.JSON},r){return this.process(e,{...r,data:t,method:l.POST},s)}postWithParams(e,t,s={},r={contentType:g.JSON},n){return this.process(e,{...n,params:t,data:s,method:l.POST},r)}put(e,t,s={contentType:g.JSON},r){return this.process(e,{...r,data:t,method:l.PUT},s)}putWithParams(e,t,s={},r={contentType:g.JSON},n){return this.process(e,{...n,params:t,data:s,method:l.PUT},r)}delete(e,t={},s={contentType:g.JSON}){return this.process(e,{data:t,method:l.DELETE},s)}deleteWithParams(e,t,s={},r={contentType:g.JSON}){return this.process(e,{params:t,data:s,method:l.DELETE},r)}},e.BuildInScopeEnum=T,e.ClientAuthenticationMethodEnum=f,e.ContentTypeEnum=g,e.HttpConfig=class HttpConfig{http={};project="";clientId="";clientSecret="";oidc=!1;uaaAddress="";upmsAddress="";msgAddress="";ossAddress="";bpmnAddress="";cmdbAddress="";iotAddress="";manageAddress="";proxy="";constructor(e,t){this.http=e,this.project=t.project,this.clientId=t.clientId,this.clientSecret=t.clientSecret,this.oidc=!!t.oidc&&t.oidc,this.proxy=t.proxy?t.proxy:"/api",this.switch(t.project)}switch(e){switch(e){case"dante":this.uaaAddress="/dante-cloud-uaa",this.upmsAddress="/dante-cloud-upms",this.msgAddress="/dante-cloud-message",this.ossAddress="/dante-cloud-oss-ability",this.bpmnAddress="/dante-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/dante-cloud-cmdb-ability",this.iotAddress="/dante-cloud-iot-ability",this.manageAddress="/dante-cloud-manage-ability";break;case"herodotus":this.uaaAddress="/herodotus-cloud-uaa",this.upmsAddress="/herodotus-cloud-upms",this.msgAddress="/herodotus-cloud-message",this.ossAddress="/herodotus-cloud-oss-ability",this.bpmnAddress="/herodotus-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/herodotus-cloud-cmdb-ability",this.iotAddress="/herodotus-cloud-iot-ability",this.manageAddress="/herodotus-cloud-manage-ability";break;default:this.uaaAddress="",this.upmsAddress="",this.msgAddress="",this.ossAddress="",this.bpmnAddress="/engine-rest",this.cmdbAddress="",this.iotAddress="",this.manageAddress=""}}getProject(){return this.project}getClientSecret(){return this.clientSecret}getClientId(){return this.clientId}isOidc(){return this.oidc}getProxy(){return this.proxy}getHttp(){return this.http}processProxy(e,t=!0){return t?this.proxy+e:e}getUaa(e=!0){return this.processProxy(this.uaaAddress,e)}getUpms(e=!0){return this.processProxy(this.upmsAddress,e)}getMsg(e=!0){return this.processProxy(this.msgAddress,e)}getOss(e=!0){return this.processProxy(this.ossAddress,e)}getBpmn(e=!0,t=!1){let s=this.processProxy(this.bpmnAddress,e);return t?i.replace(s,"engine-rest","camunda-extended"):s}getCmdb(e=!0){return this.processProxy(this.cmdbAddress,e)}getIot(e=!0){return this.processProxy(this.iotAddress,e)}getManage(e=!0){return this.processProxy(this.manageAddress,e)}},e.HttpMethodEnum=l,e.OperationEnum=y,e.PKCE=N,e.SM2Utils=x,e.SM4Utils=P,e.Service=Service,e.StatusEnum=m,e.isSuccess=e=>!(!e||!("statusText"in e))&&/^(2|3)\d{2}$/.test(String(e.status)),e.logResponse=e=>{Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())},e.notify=R,e.parseResponseStatus=(e,t)=>{let s={};s="statusText"in e?e.data:e;const r={status:e.status,code:0,detail:""};return r.code=s&&s.code?s.code:0,r.detail=s.error&&s.error.detail?s.error.detail:"",s.message?r.message=s.message:s.error&&s.error.message?r.message=s.error.message:t&&(r.message=t),r},e.standardDeleteNotify=(e,t)=>{h.fire({title:"确定删除?",text:"您将无法恢复此操作！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的, 删除!",cancelButtonText:"取消"}).then(s=>{s.value?e():t&&t()})},e.toast=_,e.useHttp=function(e){const n={timeout:12e3,paramsSerializer:e=>s.stringify(e,{arrayFormat:"brackets"})},o=(e,t)=>{const s=(e=>{switch(e){case g.URL_ENCODED:return{"Content-Type":"application/x-www-form-urlencoded"};case g.MULTI_PART:return{"Content-Type":"multipart/form-data"};default:return{"Content-Type":"application/json"}}})(e);return t?i.assignIn({},s,t):s},a=t.create(e?i.assignIn(n,e):n),c=(e,t={},s={},n=l.GET,i=g.JSON,c)=>{const{execute:d}=r.useAxios(e,{headers:o(i,c),method:n},a,{immediate:!1}),u={};return t&&(u.data=t),s&&(u.params=s),new Promise((e,t)=>{d(u).then(t=>{const s=t.response.value;e(s)}).catch(e=>{t(e)})})};return{doGet:(e,t={},s)=>c(e,"",t,l.GET,g.JSON,s),doPost:(e,t={},s=g.JSON,r={},n)=>c(e,t,r,l.POST,s,n),doPut:(e,t={},s=g.JSON,r={})=>c(e,t,r,l.PUT,s),doDelete:(e,t={},s=g.JSON,r={})=>c(e,t,r,l.DELETE,s),createHeaderWithBearer:(e,t,s)=>{const r={Authorization:A.BEARER+e};return t&&(r["X-Herodotus-Session-Id"]=t),s&&(r["X-Herodotus-Tenant-Id"]=s),r},createHeaderWithBasic:(e,t,s,r)=>{const n={Authorization:A.BASIC+u.Base64.encode(e+":"+t)};return s&&(n["X-Herodotus-Session-Id"]=s),r&&(n["X-Herodotus-Tenant-Id"]=r),n}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
