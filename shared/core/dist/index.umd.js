!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("axios"),require("qs"),require("lodash-es"),require("generate-avatar"),require("sm-crypto"),require("js-base64"),require("sweetalert2"),require("moment"),require("moment/dist/locale/zh-cn")):"function"==typeof define&&define.amd?define(["exports","axios","qs","lodash-es","generate-avatar","sm-crypto","js-base64","sweetalert2","moment","moment/dist/locale/zh-cn"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["@herodotus/core"]={},t.Axios,t.Qs,t.LodashEs,t.GenerateAvatar,t.SmCrypto,t.JsBase64,t.Sweetalert2,t.Moment)}(this,function(t,e,s,r,n,i,o,a,c){"use strict";function d(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t)for(const s in t)if("default"!==s){const r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,r.get?r:{enumerable:!0,get:()=>t[s]})}return e.default=t,Object.freeze(e)}const u=d(r);var h=(t=>(t[t.URL_ENCODED=0]="URL_ENCODED",t[t.MULTI_PART=1]="MULTI_PART",t[t.TEXT=2]="TEXT",t[t.JSON=3]="JSON",t))(h||{}),g=(t=>(t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t))(g||{}),p=(t=>(t[t.FORBIDDEN=0]="FORBIDDEN",t[t.ENABLE=1]="ENABLE",t[t.LOCKING=2]="LOCKING",t[t.EXPIRED=3]="EXPIRED",t))(p||{});let l=new Map;const m=t=>[t.method,t.url].join("&");class AxiosCanceler{addPending(t){this.removePending(t);const s=m(t);t.cancelToken=t.cancelToken||new e.CancelToken(t=>{l.has(s)||l.set(s,t)})}removeAllPending(){l.forEach(t=>{t&&r.isFunction(t)&&t()}),l.clear()}removePending(t){const e=m(t);if(l.has(e)){const t=l.get(e);t&&t(e),l.delete(e)}}reset(){l=new Map}}class AvatarUtilities{static instance=new AvatarUtilities;constructor(){}static getInstance(){return this.instance}generate(t){return`data:image/svg+xml;utf8,${n.generateFromString(t)}`}}const f=AvatarUtilities.getInstance();class SM2Utilities{static instance=new SM2Utilities;cipherMode=1;constructor(){}static getInstance(){return this.instance}createKeyPair(){return i.sm2.generateKeyPairHex()}encrypt(t,e){return"04"+i.sm2.doEncrypt(t,e,this.cipherMode)}decrypt(t,e){let s=t.substring(2).toLocaleLowerCase();return i.sm2.doDecrypt(s,e,this.cipherMode)}}class SM4Utilities{static instance=new SM4Utilities;constructor(){}static getInstance(){return this.instance}encrypt(t,e){return i.sm4.encrypt(t,e)}decrypt(t,e){return i.sm4.decrypt(t,e)}}const y=SM2Utilities.getInstance(),A=SM4Utilities.getInstance(),T=a.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,timerProgressBar:!1,didOpen:t=>{t.addEventListener("mouseenter",a.stopTimer),t.addEventListener("mouseleave",a.resumeTimer)}});class Notify{static instance=new Notify;constructor(){}static getInstance(){return this.instance}information(t,e,s){return a.fire({title:t,text:e,position:"top",icon:s,timer:5e3,showConfirmButton:!1,showClass:{popup:"animate__animated animate__fadeIn"},hideClass:{popup:"animate__animated animate__fadeOut"}})}info(t,e=""){return this.information(t,e,"info")}error(t,e=""){return this.information(t,e,"error")}warning(t,e=""){return this.information(t,e,"warning")}success(t,e=""){return this.information(t,e,"success")}question(t,e=""){return this.information(t,e,"question")}}const C=Notify.getInstance();class Toast{static instance=new Toast;constructor(){}static getInstance(){return this.instance}information(t,e){return T.fire({icon:e,title:t})}info(t){return this.information(t,"info")}error(t){return this.information(t,"error")}warning(t){return this.information(t,"warning")}success(t){return this.information(t,"success")}question(t){return this.information(t,"question")}}const P=Toast.getInstance();c.locale("zh-cn");class Service{config;constructor(t){this.config=t}getConfig(){return this.config}getParamPath(t,e){return t+"/"+e}getIdPath(t){return this.getParamPath(this.getBaseAddress(),t)}}t.lodash=u,Object.defineProperty(t,"Base64",{enumerable:!0,get:()=>o.Base64}),t.Swal=a,t.moment=c,t.AvatarUtils=f,t.Axios=class Axios{axiosInstance;axiosConfig;axiosTransform;defaultRequestOptions;constructor(t,e,s){this.axiosConfig=t,this.axiosTransform=e,this.defaultRequestOptions=s,this.axiosInstance=this.createAxiosInstance(t),this.setupInterceptors()}createAxiosInstance(t){return e.create(t)}getAxiosConfig(){return this.axiosConfig}getAxiosTransform(){return this.axiosTransform}getAxiosInstance(){return this.axiosInstance}getDefaultRequestOptions(){return this.defaultRequestOptions}getPolicy(t){switch(t){case h.URL_ENCODED:return{headers:{"Content-Type":"application/x-www-form-urlencoded"},dataConvert:t=>s.stringify(t,{arrayFormat:"brackets"})};case h.MULTI_PART:return{headers:{"Content-Type":"multipart/form-data"},dataConvert:t=>t};default:return{headers:{"Content-Type":"application/json"},dataConvert:t=>JSON.stringify(t)}}}setupInterceptors(){const t=this.getAxiosTransform();if(!t)return;const{requestInterceptors:e,requestInterceptorsCatch:s,responseInterceptors:r,responseInterceptorsCatch:n}=t,i=new AxiosCanceler;this.getAxiosInstance().interceptors.request.use(t=>{const{prohibitRepeatRequests:s}=this.getDefaultRequestOptions();return s&&i.addPending(t),e(t)},t=>s(this.getAxiosInstance(),t)),this.getAxiosInstance().interceptors.response.use(t=>(t&&i.removePending(t.config),r(t)),t=>n(this.getAxiosInstance(),t))}mergeRequestOptions(t){const e=this.getDefaultRequestOptions();return r.isEmpty(t)?e:Object.assign({},e,t)}mergeRequestConfigs(t){const e=this.getAxiosConfig(),s={serialize:t=>Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")},r=Object.assign({paramsSerializer:s},e);return t?Object.assign({},r,t):r}setupPolicy(t,e,s){const{beforeRequestHook:n}=this.getAxiosTransform(),i=this.mergeRequestOptions(e);let o=this.mergeRequestConfigs(s);n&&r.isFunction(n)&&(o=n(o,i));const a=i.contentType,c=this.getPolicy(a);return o.headers?o.headers=Object.assign(o.headers,c.headers):o.headers=c.headers,o.url=t,r.isEmpty(o.data)||(o.data=c.dataConvert(o.data)),{config:o,options:i,dataConvert:c.dataConvert}}get(t,e={},s={contentType:h.JSON}){let r=this.setupPolicy(t,s,{params:e,method:g.GET});return this.request(r.config,r.options)}post(t,e,s={contentType:h.JSON},r){let n=this.setupPolicy(t,s,{...r,data:e,method:g.POST});return this.request(n.config,n.options)}postWithParams(t,e={},s={},r={contentType:h.JSON},n){let i=this.setupPolicy(t,r,{...n,params:e,data:s,method:g.POST});return this.request(i.config,i.options)}put(t,e,s={contentType:h.JSON},r){let n=this.setupPolicy(t,s,{...r,data:e,method:g.PUT});return this.request(n.config,n.options)}putWithParams(t,e={},s={},r={contentType:h.JSON},n){let i=this.setupPolicy(t,r,{...n,params:e,data:s,method:g.PUT});return this.request(i.config,i.options)}delete(t,e={},s={contentType:h.JSON}){let r=this.setupPolicy(t,s,{data:e,method:g.DELETE});return this.request(r.config,r.options)}deleteWithParams(t,e={},s={},r={contentType:h.JSON}){let n=this.setupPolicy(t,r,{params:e,data:s,method:g.DELETE});return this.request(n.config,n.options)}request(t,e){return new Promise((s,n)=>{const{requestCatchHook:i,transformRequestHook:o}=this.getAxiosTransform();this.getAxiosInstance().request(t).then(t=>{if(o&&r.isFunction(o)){const r=o(t,e);s(r)}else s(t)}).catch(t=>{i&&r.isFunction(i)?n(i(t,e)):n(t)})})}},t.BaseService=class BaseService extends Service{getConditionAddress(){return this.getBaseAddress()+"/condition"}getListAddress(){return this.getBaseAddress()+"/list"}getTreeAddress(){return this.getBaseAddress()+"/tree"}fetch(t={}){return this.getConfig().getHttp().get(this.getBaseAddress(),t)}fetchByPage(t,e={}){if(r.isEmpty(e))return this.getConfig().getHttp().get(this.getBaseAddress(),t);{const s=Object.assign(t,e);return this.getConfig().getHttp().get(this.getConditionAddress(),s)}}fetchAll(t={}){return this.getConfig().getHttp().get(this.getListAddress(),t)}fetchTree(t={}){return this.getConfig().getHttp().get(this.getTreeAddress(),t)}saveOrUpdate(t){return this.getConfig().getHttp().post(this.getBaseAddress(),t)}delete(t){return this.getConfig().getHttp().delete(this.getIdPath(t))}assign(t){return this.getConfig().getHttp().put(this.getBaseAddress(),t,{contentType:h.URL_ENCODED})}},t.ContentTypeEnum=h,t.HttpConfig=class HttpConfig{http={};project="";clientId="";clientSecret="";oidc=!1;uaaAddress="";upmsAddress="";msgAddress="";ossAddress="";bpmnAddress="";cmdbAddress="";proxy="";constructor(t,e,s,r,n=!1,i="/api"){this.project=t,this.clientId=e,this.clientSecret=s,this.http=r,this.oidc=n,this.proxy=i,this.switch(t)}switch(t){switch(t){case"dante":this.uaaAddress="/dante-cloud-uaa",this.upmsAddress="/dante-cloud-upms",this.msgAddress="/dante-cloud-message",this.ossAddress="/dante-cloud-oss-ability",this.bpmnAddress="/dante-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/dante-cloud-cmdb-ability";break;case"herodotus":this.uaaAddress="/herodotus-cloud-uaa",this.upmsAddress="/herodotus-cloud-upms",this.msgAddress="/herodotus-cloud-message",this.ossAddress="/herodotus-cloud-oss-ability",this.bpmnAddress="/herodotus-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/herodotus-cloud-cmdb-ability";break;default:this.uaaAddress="",this.upmsAddress="",this.msgAddress="",this.ossAddress="",this.bpmnAddress="/engine-rest",this.cmdbAddress=""}}getProject(){return this.project}getClientSecret(){return this.clientSecret}getClientId(){return this.clientId}isOidc(){return this.oidc}getProxy(){return this.proxy}getHttp(){return this.http}processProxy(t,e=!0){return e?this.proxy+t:t}getUaa(t=!0){return this.processProxy(this.uaaAddress,t)}getUpms(t=!0){return this.processProxy(this.upmsAddress,t)}getMsg(t=!0){return this.processProxy(this.msgAddress,t)}getOss(t=!0){return this.processProxy(this.ossAddress,t)}getBpmn(t=!0,e=!1){let s=this.processProxy(this.bpmnAddress,t);return e?u.replace(s,"engine-rest","camunda-extended"):s}getCmdb(t=!0){return this.processProxy(this.cmdbAddress,t)}},t.HttpMethodEnum=g,t.SM2Utils=y,t.SM4Utils=A,t.Service=Service,t.StatusEnum=p,t.notify=C,t.parseResponseStatus=(t,e)=>{const s=t.data,r={};return r.status=t.status,r.code=t.data&&t.data.code?t.data.code:0,r.detail=s.error&&s.error.detail?s.error.detail:"",s.message?r.message=s.message:s.error&&s.error.message?r.message=s.error.message:e&&(r.message=e),r},t.standardDeleteNotify=(t,e)=>{a.fire({title:"确定删除?",text:"您将无法恢复此操作！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的, 删除!",cancelButtonText:"取消"}).then(s=>{s.value?t():e&&e()})},t.toast=P,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
