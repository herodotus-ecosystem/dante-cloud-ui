import t from"axios";import e from"qs";import*as s from"lodash-es";import{isFunction as r,isEmpty as n,merge as i}from"lodash-es";import o from"moment";import{default as a}from"moment";import"moment/dist/locale/zh-cn";import{generateFromString as c}from"generate-avatar";import{sm2 as d,sm4 as u}from"sm-crypto-v2";import{Base64 as h}from"js-base64";import g from"sweetalert2";import{default as p}from"sweetalert2";import{lib as l,SHA256 as m,enc as f}from"crypto-js";var A=/* @__PURE__ */(t=>(t[t.URL_ENCODED=0]="URL_ENCODED",t[t.MULTI_PART=1]="MULTI_PART",t[t.TEXT=2]="TEXT",t[t.JSON=3]="JSON",t))(A||{}),E=/* @__PURE__ */(t=>(t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t))(E||{}),T=/* @__PURE__ */(t=>(t[t.FORBIDDEN=0]="FORBIDDEN",t[t.ENABLE=1]="ENABLE",t[t.LOCKING=2]="LOCKING",t[t.EXPIRED=3]="EXPIRED",t))(T||{}),I=/* @__PURE__ */(t=>(t.BASIC="Basic ",t.BEARER="Bearer ",t))(I||{}),C=/* @__PURE__ */(t=>(t.AUTHORIZATION_CODE="authorization_code",t.REFRESH_TOKEN="refresh_token",t.CLIENT_CREDENTIALS="client_credentials",t.PASSWORD="password",t.SOCIAL_CREDENTIALS="social_credentials",t.WEBAUTHN_CREDENTIALS="webauthn_credentials",t.DEVICE_CODE="urn:ietf:params:oauth:grant-type:device_code",t.JWT_BEARER="urn:ietf:params:oauth:grant-type:jwt-bearer",t.TOKEN_EXCHANGE="urn:ietf:params:oauth:grant-type:token-exchange",t))(C||{}),y=/* @__PURE__ */(t=>(t.CLIENT_SECRET_BASIC="client_secret_basic",t.CLIENT_SECRET_POST="client_secret_post",t.CLIENT_SECRET_JWT="client_secret_jwt",t.PRIVATE_KEY_JWT="private_key_jwt",t.NONE="none",t.TLS_CLIENT_AUTH="tls_client_auth",t.SELF_SIGNED_TLS_CLIENT_AUTH="self_signed_tls_client_auth",t))(y||{}),_=/* @__PURE__ */(t=>(t.OPENID="openid",t.EMAIL="email",t.PROFILE="profile",t.PHONE="phone",t.ADDRESS="address",t.ROLES="roles",t.CLIENT_CREATE="client.create",t.CLIENT_READ="client.read",t))(_||{}),R=/* @__PURE__ */(t=>(t.CREATE="create",t.EDIT="edit",t.AUTHORIZE="authorize",t.INFO="info",t.ALLOCATABLE="allocatable",t.SETUP="setup",t.INVOKE="invoke",t))(R||{});let x=/* @__PURE__ */new Map;const S=t=>[t.method,t.url].join("&");class AxiosCanceler{addPending(e){this.removePending(e);const s=S(e);e.cancelToken=e.cancelToken||new t.CancelToken(t=>{x.has(s)||x.set(s,t)})}removeAllPending(){x.forEach(t=>{t&&r(t)&&t()}),x.clear()}removePending(t){const e=S(t);if(x.has(e)){const t=x.get(e);t&&t(e),x.delete(e)}}reset(){x=/* @__PURE__ */new Map}}class Axios{axiosInstance;defaultAxiosRequestConfig;defaultRequestOptions;axiosInstanceHooks;constructor(t,e,s){this.defaultAxiosRequestConfig=t,this.defaultRequestOptions=s,this.axiosInstanceHooks=e,this.axiosInstance=this.createAxiosInstance(t),this.setupInterceptors()}createAxiosInstance(e){return t.create(e)}getDefaultAxiosRequestConfig(){return this.defaultAxiosRequestConfig}getDefaultRequestOptions(){return this.defaultRequestOptions}getAxiosInstanceHooks(){return this.axiosInstanceHooks}getAxiosInstance(){return this.axiosInstance}createHttpHeaderPolicy(t){switch(t){case A.URL_ENCODED:return{headers:{"Content-Type":"application/x-www-form-urlencoded"},dataConvert:t=>e.stringify(t,{arrayFormat:"brackets"})};case A.MULTI_PART:return{headers:{"Content-Type":"multipart/form-data"},dataConvert:t=>t};default:return{headers:{"Content-Type":"application/json"},dataConvert:t=>JSON.stringify(t)}}}setupInterceptors(){const t=this.getAxiosInstanceHooks();if(!t)return;const{requestInterceptors:e,requestInterceptorsError:s,responseInterceptors:r,responseInterceptorsError:n}=t,i=new AxiosCanceler;this.getAxiosInstance().interceptors.request.use(t=>{const{prohibitRepeatRequests:s}=this.getDefaultRequestOptions();return s&&i.addPending(t),e(t)},t=>s(this.getAxiosInstance(),t)),this.getAxiosInstance().interceptors.response.use(t=>(t&&i.removePending(t.config),r(t)),t=>n(this.getAxiosInstance(),t))}mergeHttpRequestOptions(t){const e=this.getDefaultRequestOptions();return n(t)?e:i({},e,t)}mergeAxiosRequestConfigs(t){const s=this.getDefaultAxiosRequestConfig(),r=i({},s,{paramsSerializer:{serialize:t=>e.stringify(t,{arrayFormat:"brackets"})}});return n(t)?r:i({},r,t)}setupRequestStrategy(t,e,s){const{onRequestHook:o}=this.getAxiosInstanceHooks(),a=this.mergeHttpRequestOptions(s);let c=this.mergeAxiosRequestConfigs(e);o&&r(o)&&(c=o(c,a));const d=this.createHttpHeaderPolicy(a.contentType);return c.headers?c.headers=i(c.headers,d.headers):c.headers=d.headers,c.url=t,n(c.data)||(c.data=d.dataConvert(c.data)),{config:c,options:a}}request(t,e){return new Promise((s,n)=>{const{onResponseErrorHook:i,onResponseSuccessHook:o}=this.getAxiosInstanceHooks();this.getAxiosInstance().request(t).then(t=>{if(o&&r(o)){const r=o(t,e);s(r)}else s(t)}).catch(t=>{if(i&&r(i)){const s=i(t,e);n(s)}else n(t)})})}process(t,e,s={}){let r=this.setupRequestStrategy(t,e,s);return this.request(r.config,r.options)}get(t,e={},s={contentType:A.JSON}){return this.process(t,{params:e,method:E.GET},s)}post(t,e,s={contentType:A.JSON},r){return this.process(t,{...r,data:e,method:E.POST},s)}postWithParams(t,e,s={},r={contentType:A.JSON},n){return this.process(t,{...n,params:e,data:s,method:E.POST},r)}put(t,e,s={contentType:A.JSON},r){return this.process(t,{...r,data:e,method:E.PUT},s)}putWithParams(t,e,s={},r={contentType:A.JSON},n){return this.process(t,{...n,params:e,data:s,method:E.PUT},r)}delete(t,e={},s={contentType:A.JSON}){return this.process(t,{data:e,method:E.DELETE},s)}deleteWithParams(t,e,s={},r={contentType:A.JSON}){return this.process(t,{params:e,data:s,method:E.DELETE},r)}}const P=(t,e)=>{let s={};s="statusText"in t?t.data:t;const r={status:t.status,code:0,detail:""};return r.code=s&&s.code?s.code:0,r.detail=s.error&&s.error.detail?s.error.detail:"",s.message?r.message=s.message:s.error&&s.error.message?r.message=s.error.message:e&&(r.message=e),r},O=t=>{Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())},N=t=>!(!t||!("statusText"in t))&&/^(2|3)\d{2}$/.test(String(t.status));o.locale("zh-cn");class HttpConfig{http={};project="";clientId="";clientSecret="";oidc=!1;uaaAddress="";upmsAddress="";msgAddress="";ossAddress="";bpmnAddress="";cmdbAddress="";proxy="";constructor(t,e,s,r,n=!1,i="/api"){this.project=t,this.clientId=e,this.clientSecret=s,this.http=r,this.oidc=n,this.proxy=i,this.switch(t)}switch(t){switch(t){case"dante":this.uaaAddress="/dante-cloud-uaa",this.upmsAddress="/dante-cloud-upms",this.msgAddress="/dante-cloud-message",this.ossAddress="/dante-cloud-oss-ability",this.bpmnAddress="/dante-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/dante-cloud-cmdb-ability";break;case"herodotus":this.uaaAddress="/herodotus-cloud-uaa",this.upmsAddress="/herodotus-cloud-upms",this.msgAddress="/herodotus-cloud-message",this.ossAddress="/herodotus-cloud-oss-ability",this.bpmnAddress="/herodotus-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/herodotus-cloud-cmdb-ability";break;default:this.uaaAddress="",this.upmsAddress="",this.msgAddress="",this.ossAddress="",this.bpmnAddress="/engine-rest",this.cmdbAddress=""}}getProject(){return this.project}getClientSecret(){return this.clientSecret}getClientId(){return this.clientId}isOidc(){return this.oidc}getProxy(){return this.proxy}getHttp(){return this.http}processProxy(t,e=!0){return e?this.proxy+t:t}getUaa(t=!0){return this.processProxy(this.uaaAddress,t)}getUpms(t=!0){return this.processProxy(this.upmsAddress,t)}getMsg(t=!0){return this.processProxy(this.msgAddress,t)}getOss(t=!0){return this.processProxy(this.ossAddress,t)}getBpmn(t=!0,e=!1){let r=this.processProxy(this.bpmnAddress,t);return e?s.replace(r,"engine-rest","camunda-extended"):r}getCmdb(t=!0){return this.processProxy(this.cmdbAddress,t)}}class Service{config;constructor(t){this.config=t}getConfig(){return this.config}getParamPath(t,e){return t+"/"+e}getIdPath(t){return this.getParamPath(this.getBaseAddress(),t)}}class BaseService extends Service{getConditionAddress(){return this.getBaseAddress()+"/condition"}getListAddress(){return this.getBaseAddress()+"/list"}getTreeAddress(){return this.getBaseAddress()+"/tree"}fetch(t={}){return this.getConfig().getHttp().get(this.getBaseAddress(),t)}fetchByPage(t,e={}){if(n(e))return this.getConfig().getHttp().get(this.getBaseAddress(),t);{const s=Object.assign(t,e);return this.getConfig().getHttp().get(this.getConditionAddress(),s)}}fetchAll(t={}){return this.getConfig().getHttp().get(this.getListAddress(),t)}fetchTree(t={}){return this.getConfig().getHttp().get(this.getTreeAddress(),t)}saveOrUpdate(t){return this.getConfig().getHttp().post(this.getBaseAddress(),t)}delete(t){return this.getConfig().getHttp().delete(this.getIdPath(t))}assign(t){return this.getConfig().getHttp().put(this.getBaseAddress(),t,{contentType:A.URL_ENCODED})}}class AvatarUtilities{static instance=new AvatarUtilities;constructor(){}static getInstance(){return this.instance}generate(t){return`data:image/svg+xml;utf8,${c(t)}`}}const w=AvatarUtilities.getInstance();class SM2Utilities{static instance=new SM2Utilities;cipherMode=1;constructor(){}static getInstance(){return this.instance}createKeyPair(){return d.generateKeyPairHex()}encrypt(t,e){return"04"+d.doEncrypt(t,e,this.cipherMode)}decrypt(t,e){let s=t.substring(2).toLocaleLowerCase();return d.doDecrypt(s,e,this.cipherMode,{output:"string"})}}class SM4Utilities{static instance=new SM4Utilities;constructor(){}static getInstance(){return this.instance}encrypt(t,e){return u.encrypt(t,e,{output:"string"})}decrypt(t,e){return u.decrypt(t,e,{output:"string"})}}const L=SM2Utilities.getInstance(),D=SM4Utilities.getInstance(),B=g.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,timerProgressBar:!1,didOpen:t=>{t.addEventListener("mouseenter",g.stopTimer),t.addEventListener("mouseleave",g.resumeTimer)}}),H=(t,e)=>{g.fire({title:"确定删除?",text:"您将无法恢复此操作！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的, 删除!",cancelButtonText:"取消"}).then(s=>{s.value?t():e&&e()})};class Notify{static instance=new Notify;constructor(){}static getInstance(){return this.instance}information(t,e,s){return g.fire({title:t,text:e,position:"top",icon:s,timer:5e3,showConfirmButton:!1,showClass:{popup:"animate__animated animate__fadeIn"},hideClass:{popup:"animate__animated animate__fadeOut"}})}info(t,e=""){return this.information(t,e,"info")}error(t,e=""){return this.information(t,e,"error")}warning(t,e=""){return this.information(t,e,"warning")}success(t,e=""){return this.information(t,e,"success")}question(t,e=""){return this.information(t,e,"question")}}const b=Notify.getInstance();class Toast{static instance=new Toast;constructor(){}static getInstance(){return this.instance}information(t,e){return B.fire({icon:e,title:t})}info(t){return this.information(t,"info")}error(t){return this.information(t,"error")}warning(t){return this.information(t,"warning")}success(t){return this.information(t,"success")}question(t){return this.information(t,"question")}}const U=Toast.getInstance();class PkceUtilities{static instance=new PkceUtilities;constructor(){}static getInstance(){return this.instance}toBytesInt32(t){const e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t,!1),e}getRandomValues(t){const e=l.WordArray.random(t),s=[];return e.words.forEach(t=>{const e=this.toBytesInt32(t),r=new Uint8Array(e);for(let n=0;n<4;n++){let t=r[n];void 0!==t&&s.push(t)}}),s}random(t){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let s="";const r=this.getRandomValues(t);for(let n=0;n<t;n++){let t=r[n];if(void 0!==t){s+=e[t%66]}}return s}generateVerifier(t){return this.random(t)}generateChallenge(t){return m(t).toString(f.Base64url)}generateCodePair(t=43){if(t<43||t>128)throw`Expected a length between 43 and 128. Received ${t}.`;const e=this.generateVerifier(t);return{codeVerifier:e,codeChallenge:this.generateChallenge(e)}}verifyChallenge(t,e){return this.generateChallenge(t)===e}}const v=PkceUtilities.getInstance();export{C as AuthorizationGrantTypeEnum,I as AuthorizationTokenEnum,w as AvatarUtils,Axios,h as Base64,BaseService,_ as BuildInScopeEnum,y as ClientAuthenticationMethodEnum,A as ContentTypeEnum,HttpConfig,E as HttpMethodEnum,R as OperationEnum,v as PKCE,L as SM2Utils,D as SM4Utils,Service,T as StatusEnum,p as Swal,N as isSuccess,s as lodash,O as logResponse,a as moment,b as notify,P as parseResponseStatus,H as standardDeleteNotify,U as toast};
