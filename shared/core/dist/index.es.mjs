import t from"axios";import e from"qs";import*as s from"lodash-es";import{isFunction as r,isEmpty as i}from"lodash-es";import{generateFromString as n}from"generate-avatar";import{sm2 as o,sm4 as a}from"sm-crypto-v2";import{Base64 as c}from"js-base64";import d from"sweetalert2";import{default as u}from"sweetalert2";import h from"moment";import{default as g}from"moment";import"moment/dist/locale/zh-cn";var p=/* @__PURE__ */(t=>(t[t.URL_ENCODED=0]="URL_ENCODED",t[t.MULTI_PART=1]="MULTI_PART",t[t.TEXT=2]="TEXT",t[t.JSON=3]="JSON",t))(p||{}),m=/* @__PURE__ */(t=>(t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t))(m||{}),l=/* @__PURE__ */(t=>(t[t.FORBIDDEN=0]="FORBIDDEN",t[t.ENABLE=1]="ENABLE",t[t.LOCKING=2]="LOCKING",t[t.EXPIRED=3]="EXPIRED",t))(l||{});let f=/* @__PURE__ */new Map;const A=t=>[t.method,t.url].join("&");class AxiosCanceler{addPending(e){this.removePending(e);const s=A(e);e.cancelToken=e.cancelToken||new t.CancelToken(t=>{f.has(s)||f.set(s,t)})}removeAllPending(){f.forEach(t=>{t&&r(t)&&t()}),f.clear()}removePending(t){const e=A(t);if(f.has(e)){const t=f.get(e);t&&t(e),f.delete(e)}}reset(){f=/* @__PURE__ */new Map}}class Axios{axiosInstance;axiosConfig;axiosTransform;defaultRequestOptions;constructor(t,e,s){this.axiosConfig=t,this.axiosTransform=e,this.defaultRequestOptions=s,this.axiosInstance=this.createAxiosInstance(t),this.setupInterceptors()}createAxiosInstance(e){return t.create(e)}getAxiosConfig(){return this.axiosConfig}getAxiosTransform(){return this.axiosTransform}getAxiosInstance(){return this.axiosInstance}getDefaultRequestOptions(){return this.defaultRequestOptions}getPolicy(t){switch(t){case p.URL_ENCODED:return{headers:{"Content-Type":"application/x-www-form-urlencoded"},dataConvert:t=>e.stringify(t,{arrayFormat:"brackets"})};case p.MULTI_PART:return{headers:{"Content-Type":"multipart/form-data"},dataConvert:t=>t};default:return{headers:{"Content-Type":"application/json"},dataConvert:t=>JSON.stringify(t)}}}setupInterceptors(){const t=this.getAxiosTransform();if(!t)return;const{requestInterceptors:e,requestInterceptorsCatch:s,responseInterceptors:r,responseInterceptorsCatch:i}=t,n=new AxiosCanceler;this.getAxiosInstance().interceptors.request.use(t=>{const{prohibitRepeatRequests:s}=this.getDefaultRequestOptions();return s&&n.addPending(t),e(t)},t=>s(this.getAxiosInstance(),t)),this.getAxiosInstance().interceptors.response.use(t=>(t&&n.removePending(t.config),r(t)),t=>i(this.getAxiosInstance(),t))}mergeRequestOptions(t){const e=this.getDefaultRequestOptions();return i(t)?e:Object.assign({},e,t)}mergeRequestConfigs(t){const e=this.getAxiosConfig(),s={serialize:t=>Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&")},r=Object.assign({paramsSerializer:s},e);return t?Object.assign({},r,t):r}setupPolicy(t,e,s){const{beforeRequestHook:n}=this.getAxiosTransform(),o=this.mergeRequestOptions(e);let a=this.mergeRequestConfigs(s);n&&r(n)&&(a=n(a,o));const c=o.contentType,d=this.getPolicy(c);return a.headers?a.headers=Object.assign(a.headers,d.headers):a.headers=d.headers,a.url=t,i(a.data)||(a.data=d.dataConvert(a.data)),{config:a,options:o,dataConvert:d.dataConvert}}get(t,e={},s={contentType:p.JSON}){let r=this.setupPolicy(t,s,{params:e,method:m.GET});return this.request(r.config,r.options)}post(t,e,s={contentType:p.JSON},r){let i=this.setupPolicy(t,s,{...r,data:e,method:m.POST});return this.request(i.config,i.options)}postWithParams(t,e={},s={},r={contentType:p.JSON},i){let n=this.setupPolicy(t,r,{...i,params:e,data:s,method:m.POST});return this.request(n.config,n.options)}put(t,e,s={contentType:p.JSON},r){let i=this.setupPolicy(t,s,{...r,data:e,method:m.PUT});return this.request(i.config,i.options)}putWithParams(t,e={},s={},r={contentType:p.JSON},i){let n=this.setupPolicy(t,r,{...i,params:e,data:s,method:m.PUT});return this.request(n.config,n.options)}delete(t,e={},s={contentType:p.JSON}){let r=this.setupPolicy(t,s,{data:e,method:m.DELETE});return this.request(r.config,r.options)}deleteWithParams(t,e={},s={},r={contentType:p.JSON}){let i=this.setupPolicy(t,r,{params:e,data:s,method:m.DELETE});return this.request(i.config,i.options)}request(t,e){return new Promise((s,i)=>{const{requestCatchHook:n,transformRequestHook:o}=this.getAxiosTransform();this.getAxiosInstance().request(t).then(t=>{if(o&&r(o)){const r=o(t,e);s(r)}else s(t)}).catch(t=>{n&&r(n)?i(n(t,e)):i(t)})})}}const y=(t,e)=>{const s=t.data,r={};return r.status=t.status,r.code=t.data&&t.data.code?t.data.code:0,r.detail=s.error&&s.error.detail?s.error.detail:"",s.message?r.message=s.message:s.error&&s.error.message?r.message=s.error.message:e&&(r.message=e),r};class AvatarUtilities{static instance=new AvatarUtilities;constructor(){}static getInstance(){return this.instance}generate(t){return`data:image/svg+xml;utf8,${n(t)}`}}const T=AvatarUtilities.getInstance();class SM2Utilities{static instance=new SM2Utilities;cipherMode=1;constructor(){}static getInstance(){return this.instance}createKeyPair(){return o.generateKeyPairHex()}encrypt(t,e){return"04"+o.doEncrypt(t,e,this.cipherMode)}decrypt(t,e){let s=t.substring(2).toLocaleLowerCase();return o.doDecrypt(s,e,this.cipherMode,{output:"string"})}}class SM4Utilities{static instance=new SM4Utilities;constructor(){}static getInstance(){return this.instance}encrypt(t,e){return a.encrypt(t,e,{output:"string"})}decrypt(t,e){return a.decrypt(t,e,{output:"string"})}}const C=SM2Utilities.getInstance(),P=SM4Utilities.getInstance(),x=d.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,timerProgressBar:!1,didOpen:t=>{t.addEventListener("mouseenter",d.stopTimer),t.addEventListener("mouseleave",d.resumeTimer)}}),I=(t,e)=>{d.fire({title:"确定删除?",text:"您将无法恢复此操作！",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是的, 删除!",cancelButtonText:"取消"}).then(s=>{s.value?t():e&&e()})};class Notify{static instance=new Notify;constructor(){}static getInstance(){return this.instance}information(t,e,s){return d.fire({title:t,text:e,position:"top",icon:s,timer:5e3,showConfirmButton:!1,showClass:{popup:"animate__animated animate__fadeIn"},hideClass:{popup:"animate__animated animate__fadeOut"}})}info(t,e=""){return this.information(t,e,"info")}error(t,e=""){return this.information(t,e,"error")}warning(t,e=""){return this.information(t,e,"warning")}success(t,e=""){return this.information(t,e,"success")}question(t,e=""){return this.information(t,e,"question")}}const O=Notify.getInstance();class Toast{static instance=new Toast;constructor(){}static getInstance(){return this.instance}information(t,e){return x.fire({icon:e,title:t})}info(t){return this.information(t,"info")}error(t){return this.information(t,"error")}warning(t){return this.information(t,"warning")}success(t){return this.information(t,"success")}question(t){return this.information(t,"question")}}const E=Toast.getInstance();h.locale("zh-cn");class HttpConfig{http={};project="";clientId="";clientSecret="";oidc=!1;uaaAddress="";upmsAddress="";msgAddress="";ossAddress="";bpmnAddress="";cmdbAddress="";proxy="";constructor(t,e,s,r,i=!1,n="/api"){this.project=t,this.clientId=e,this.clientSecret=s,this.http=r,this.oidc=i,this.proxy=n,this.switch(t)}switch(t){switch(t){case"dante":this.uaaAddress="/dante-cloud-uaa",this.upmsAddress="/dante-cloud-upms",this.msgAddress="/dante-cloud-message",this.ossAddress="/dante-cloud-oss-ability",this.bpmnAddress="/dante-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/dante-cloud-cmdb-ability";break;case"herodotus":this.uaaAddress="/herodotus-cloud-uaa",this.upmsAddress="/herodotus-cloud-upms",this.msgAddress="/herodotus-cloud-message",this.ossAddress="/herodotus-cloud-oss-ability",this.bpmnAddress="/herodotus-cloud-bpmn-ability/engine-rest",this.cmdbAddress="/herodotus-cloud-cmdb-ability";break;default:this.uaaAddress="",this.upmsAddress="",this.msgAddress="",this.ossAddress="",this.bpmnAddress="/engine-rest",this.cmdbAddress=""}}getProject(){return this.project}getClientSecret(){return this.clientSecret}getClientId(){return this.clientId}isOidc(){return this.oidc}getProxy(){return this.proxy}getHttp(){return this.http}processProxy(t,e=!0){return e?this.proxy+t:t}getUaa(t=!0){return this.processProxy(this.uaaAddress,t)}getUpms(t=!0){return this.processProxy(this.upmsAddress,t)}getMsg(t=!0){return this.processProxy(this.msgAddress,t)}getOss(t=!0){return this.processProxy(this.ossAddress,t)}getBpmn(t=!0,e=!1){let r=this.processProxy(this.bpmnAddress,t);return e?s.replace(r,"engine-rest","camunda-extended"):r}getCmdb(t=!0){return this.processProxy(this.cmdbAddress,t)}}class Service{config;constructor(t){this.config=t}getConfig(){return this.config}getParamPath(t,e){return t+"/"+e}getIdPath(t){return this.getParamPath(this.getBaseAddress(),t)}}class BaseService extends Service{getConditionAddress(){return this.getBaseAddress()+"/condition"}getListAddress(){return this.getBaseAddress()+"/list"}getTreeAddress(){return this.getBaseAddress()+"/tree"}fetch(t={}){return this.getConfig().getHttp().get(this.getBaseAddress(),t)}fetchByPage(t,e={}){if(i(e))return this.getConfig().getHttp().get(this.getBaseAddress(),t);{const s=Object.assign(t,e);return this.getConfig().getHttp().get(this.getConditionAddress(),s)}}fetchAll(t={}){return this.getConfig().getHttp().get(this.getListAddress(),t)}fetchTree(t={}){return this.getConfig().getHttp().get(this.getTreeAddress(),t)}saveOrUpdate(t){return this.getConfig().getHttp().post(this.getBaseAddress(),t)}delete(t){return this.getConfig().getHttp().delete(this.getIdPath(t))}assign(t){return this.getConfig().getHttp().put(this.getBaseAddress(),t,{contentType:p.URL_ENCODED})}}export{T as AvatarUtils,Axios,c as Base64,BaseService,p as ContentTypeEnum,HttpConfig,m as HttpMethodEnum,C as SM2Utils,P as SM4Utils,Service,l as StatusEnum,u as Swal,s as lodash,g as moment,O as notify,y as parseResponseStatus,I as standardDeleteNotify,E as toast};
